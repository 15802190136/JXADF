!function(){function t(){return e.observe.apply(this,arguments),this._handles.push(arguments),this}var i=Flotr.DOM,e=Flotr.EventAdapter,s=Flotr._,o=Flotr;Graph=function(t,i,n){this._setEl(t),this._initMembers(),this._initPlugins(),e.fire(this.el,"flotr:beforeinit",[this]),this.data=i,this.series=o.Series.getSeries(i),this._initOptions(n),this._initGraphTypes(),this._initCanvas(),this._text=new o.Text({element:this.el,ctx:this.ctx,html:this.options.HtmlText,textEnabled:this.textEnabled}),e.fire(this.el,"flotr:afterconstruct",[this]),this._initEvents(),this.findDataRanges(),this.calculateSpacing(),this.draw(s.bind(function(){e.fire(this.el,"flotr:afterinit",[this])},this))},Graph.prototype={destroy:function(){e.fire(this.el,"flotr:destroy"),s.each(this._handles,function(t){e.stopObserving.apply(this,t)}),this._handles=[],this.el.graph=null},observe:t,_observe:t,processColor:function(t,i){var e={x1:0,y1:0,x2:this.plotWidth,y2:this.plotHeight,opacity:1,ctx:this.ctx};return s.extend(e,i),o.Color.processColor(t,e)},findDataRanges:function(){var t,i,e,n=this.axes;s.each(this.series,function(s){e=s.getRange(),e&&(t=s.xaxis,i=s.yaxis,t.datamin=Math.min(e.xmin,t.datamin),t.datamax=Math.max(e.xmax,t.datamax),i.datamin=Math.min(e.ymin,i.datamin),i.datamax=Math.max(e.ymax,i.datamax),t.used=t.used||e.xused,i.used=i.used||e.yused)},this),n.x.used||n.x2.used||(n.x.used=!0),n.y.used||n.y2.used||(n.y.used=!0),s.each(n,function(t){t.calculateRange()});var h=s.keys(o.graphTypes),a=!1;s.each(this.series,function(t){t.hide||(s.each(h,function(i){t[i]&&t[i].show&&(this.extendRange(i,t),a=!0)},this),a||this.extendRange(this.options.defaultType,t))},this)},extendRange:function(t,i){this[t].extendRange&&this[t].extendRange(i,i.data,i[t],this[t]),this[t].extendYRange&&this[t].extendYRange(i.yaxis,i.data,i[t],this[t]),this[t].extendXRange&&this[t].extendXRange(i.xaxis,i.data,i[t],this[t])},calculateSpacing:function(){var t,i,e=this.axes,o=this.options,n=this.series,h=o.grid.labelMargin,a=this._text,l=e.x,r=e.x2,c=e.y,u=e.y2,d=o.grid.outlineWidth;for(s.each(e,function(t){t.calculateTicks(),t.calculateTextDimensions(a,o)}),i=a.dimensions(o.title,{size:1.5*o.fontSize},"font-size:1em;font-weight:bold;","flotr-title"),this.titleHeight=i.height,i=a.dimensions(o.subtitle,{size:o.fontSize},"font-size:smaller;","flotr-subtitle"),this.subtitleHeight=i.height,t=0;t<o.length;++t)n[t].points.show&&(d=Math.max(d,n[t].points.radius+n[t].points.lineWidth/2));var p=this.plotOffset;l.options.margin===!1?(p.bottom=0,p.top=0):l.options.margin===!0?(p.bottom+=(o.grid.circular?0:l.used&&l.options.showLabels?l.maxLabel.height+h:0)+(l.used&&l.options.title?l.titleSize.height+h:0)+d,p.top+=(o.grid.circular?0:r.used&&r.options.showLabels?r.maxLabel.height+h:0)+(r.used&&r.options.title?r.titleSize.height+h:0)+this.subtitleHeight+this.titleHeight+d):(p.bottom=l.options.margin,p.top=l.options.margin),c.options.margin===!1?(p.left=0,p.right=0):c.options.margin===!0?(p.left+=(o.grid.circular?0:c.used&&c.options.showLabels?c.maxLabel.width+h:0)+(c.used&&c.options.title?c.titleSize.width+h:0)+d,p.right+=(o.grid.circular?0:u.used&&u.options.showLabels?u.maxLabel.width+h:0)+(u.used&&u.options.title?u.titleSize.width+h:0)+d):(p.left=c.options.margin,p.right=c.options.margin),p.top=Math.floor(p.top),this.plotWidth=this.canvasWidth-p.left-p.right,this.plotHeight=this.canvasHeight-p.bottom-p.top,l.length=r.length=this.plotWidth,c.length=u.length=this.plotHeight,c.offset=u.offset=this.plotHeight,l.setScale(),r.setScale(),c.setScale(),u.setScale()},draw:function(t){var i,s=this.ctx;if(e.fire(this.el,"flotr:beforedraw",[this.series,this]),this.series.length){for(s.save(),s.translate(this.plotOffset.left,this.plotOffset.top),i=0;i<this.series.length;i++)this.series[i].hide||this.drawSeries(this.series[i]);s.restore(),this.clip()}e.fire(this.el,"flotr:afterdraw",[this.series,this]),t&&t()},drawSeries:function(t){function i(t,i){var e=this.getOptions(t,i);this[i].draw(e)}var e=!1;t=t||this.series,s.each(o.graphTypes,function(s,o){t[o]&&t[o].show&&this[o]&&(e=!0,i.call(this,t,o))},this),e||i.call(this,t,this.options.defaultType)},getOptions:function(t,i){var e=t[i],s=(this[i],t.xaxis),n=t.yaxis,h={context:this.ctx,width:this.plotWidth,height:this.plotHeight,fontSize:this.options.fontSize,fontColor:this.options.fontColor,textEnabled:this.textEnabled,htmlText:this.options.HtmlText,text:this._text,element:this.el,data:t.data,color:t.color,shadowSize:t.shadowSize,xScale:s.d2p,yScale:n.d2p,xInverse:s.p2d,yInverse:n.p2d};return h=o.merge(e,h),h.fillStyle=this.processColor(e.fillColor||t.color,{opacity:e.fillOpacity}),h},getEventPosition:function(t){var s,o,n,h=document,a=h.body,l=h.documentElement,r=this.axes,c=this.plotOffset,u=this.lastMousePos,d=e.eventPointer(t),p=d.x-u.pageX,f=d.y-u.pageY;return"ontouchstart"in this.el?(s=i.position(this.overlay),o=d.x-s.left-c.left,n=d.y-s.top-c.top):(s=this.overlay.getBoundingClientRect(),o=t.clientX-s.left-c.left-a.scrollLeft-l.scrollLeft,n=t.clientY-s.top-c.top-a.scrollTop-l.scrollTop),{x:r.x.p2d(o),x2:r.x2.p2d(o),y:r.y.p2d(n),y2:r.y2.p2d(n),relX:o,relY:n,dX:p,dY:f,absX:d.x,absY:d.y,pageX:d.x,pageY:d.y}},clickHandler:function(t){return this.ignoreClick?(this.ignoreClick=!1,this.ignoreClick):void e.fire(this.el,"flotr:click",[this.getEventPosition(t),this])},mouseMoveHandler:function(t){if(!this.mouseDownMoveHandler){var i=this.getEventPosition(t);e.fire(this.el,"flotr:mousemove",[t,i,this]),this.lastMousePos=i}},mouseDownHandler:function(t){this.mouseUpHandler||(this.mouseUpHandler=s.bind(function(t){e.stopObserving(document,"mouseup",this.mouseUpHandler),e.stopObserving(document,"mousemove",this.mouseDownMoveHandler),this.mouseDownMoveHandler=null,this.mouseUpHandler=null,e.fire(this.el,"flotr:mouseup",[t,this])},this),this.mouseDownMoveHandler=s.bind(function(i){var s=this.getEventPosition(i);e.fire(this.el,"flotr:mousemove",[t,s,this]),this.lastMousePos=s},this),e.observe(document,"mouseup",this.mouseUpHandler),e.observe(document,"mousemove",this.mouseDownMoveHandler),e.fire(this.el,"flotr:mousedown",[t,this]),this.ignoreClick=!1)},drawTooltip:function(t,e,s,o){var n=this.getMouseTrack(),h="opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;",a=o.position,l=o.margin,r=this.plotOffset;null!==e&&null!==s?(o.relative?("n"==a.charAt(0)?h+="bottom:"+(l-r.top-s+this.canvasHeight)+"px;top:auto;":"s"==a.charAt(0)&&(h+="top:"+(l+r.top+s)+"px;bottom:auto;"),"e"==a.charAt(1)?h+="left:"+(l+r.left+e)+"px;right:auto;":"w"==a.charAt(1)&&(h+="right:"+(l-r.left-e+this.canvasWidth)+"px;left:auto;")):("n"==a.charAt(0)?h+="top:"+(l+r.top)+"px;bottom:auto;":"s"==a.charAt(0)&&(h+="bottom:"+(l+r.bottom)+"px;top:auto;"),"e"==a.charAt(1)?h+="right:"+(l+r.right)+"px;left:auto;":"w"==a.charAt(1)&&(h+="left:"+(l+r.left)+"px;right:auto;")),n.style.cssText=h,i.empty(n),i.insert(n,t),i.show(n)):i.hide(n)},clip:function(t){var i=this.plotOffset,e=this.canvasWidth,s=this.canvasHeight;if(t=t||this.ctx,o.isIE&&o.isIE<9&&!o.isFlashCanvas){if(t===this.octx)return;t.save(),t.fillStyle=this.processColor(this.options.ieBackgroundColor),t.fillRect(0,0,e,i.top),t.fillRect(0,0,i.left,s),t.fillRect(0,s-i.bottom,e,i.bottom),t.fillRect(e-i.right,0,i.right,s),t.restore()}else t.clearRect(0,0,e,i.top),t.clearRect(0,0,i.left,s),t.clearRect(0,s-i.bottom,e,i.bottom),t.clearRect(e-i.right,0,i.right,s)},_initMembers:function(){this._handles=[],this.lastMousePos={pageX:null,pageY:null},this.plotOffset={left:0,right:0,top:0,bottom:0},this.ignoreClick=!0,this.prevHit=null},_initGraphTypes:function(){s.each(o.graphTypes,function(t,i){this[i]=o.clone(t)},this)},_initEvents:function(){var t,i,o,n=this.el;"ontouchstart"in n?(t=s.bind(function(s){o=!0,e.stopObserving(document,"touchend",t),e.fire(n,"flotr:mouseup",[s,this]),this.multitouches=null,i||this.clickHandler(s)},this),this.observe(this.overlay,"touchstart",s.bind(function(s){i=!1,o=!1,this.ignoreClick=!1,s.touches&&s.touches.length>1&&(this.multitouches=s.touches),e.fire(n,"flotr:mousedown",[s,this]),this.observe(document,"touchend",t)},this)),this.observe(this.overlay,"touchmove",s.bind(function(t){var s=this.getEventPosition(t);this.options.preventDefault&&t.preventDefault(),i=!0,this.multitouches||t.touches&&t.touches.length>1?this.multitouches=t.touches:o||e.fire(n,"flotr:mousemove",[t,s,this]),this.lastMousePos=s},this))):this.observe(this.overlay,"mousedown",s.bind(this.mouseDownHandler,this)).observe(n,"mousemove",s.bind(this.mouseMoveHandler,this)).observe(this.overlay,"click",s.bind(this.clickHandler,this)).observe(n,"mouseout",function(t){e.fire(n,"flotr:mouseout",t)})},_initCanvas:function(){function t(t,e){return t||(t=i.create("canvas"),"undefined"!=typeof FlashCanvas&&"function"==typeof t.getContext&&(FlashCanvas.initElement(t),this.isFlashCanvas=!0),t.className="flotr-"+e,t.style.cssText="position:absolute;left:0px;top:0px;",i.insert(a,t)),s.each(h,function(s,o){i.show(t),("canvas"!=e||t.getAttribute(o)!==s)&&(t.setAttribute(o,s*l.resolution),t.style[o]=s+"px")}),t.context_=null,t}function e(t){window.G_vmlCanvasManager&&window.G_vmlCanvasManager.initElement(t);var i=t.getContext("2d");return window.G_vmlCanvasManager||i.scale(l.resolution,l.resolution),i}var o,n,h,a=this.el,l=this.options,r=a.children,c=[];for(n=r.length;n--;)o=r[n],this.canvas||"flotr-canvas"!==o.className?this.overlay||"flotr-overlay"!==o.className?c.push(o):this.overlay=o:this.canvas=o;for(n=c.length;n--;)a.removeChild(c[n]);if(i.setStyles(a,{position:"relative"}),h={},h.width=a.clientWidth,h.height=a.clientHeight,h.width<=0||h.height<=0||l.resolution<=0)throw"Invalid dimensions for plot, width = "+h.width+", height = "+h.height+", resolution = "+l.resolution;this.canvas=t(this.canvas,"canvas"),this.overlay=t(this.overlay,"overlay"),this.ctx=e(this.canvas),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.octx=e(this.overlay),this.octx.clearRect(0,0,this.overlay.width,this.overlay.height),this.canvasHeight=h.height,this.canvasWidth=h.width,this.textEnabled=!!this.ctx.drawText||!!this.ctx.fillText},_initPlugins:function(){s.each(o.plugins,function(t,i){s.each(t.callbacks,function(t,i){this.observe(this.el,i,s.bind(t,this))},this),this[i]=o.clone(t),s.each(this[i],function(t,e){s.isFunction(t)&&(this[i][e]=s.bind(t,this))},this)},this)},_initOptions:function(t){var i=o.clone(o.defaultOptions);i.x2axis=s.extend(s.clone(i.xaxis),i.x2axis),i.y2axis=s.extend(s.clone(i.yaxis),i.y2axis),this.options=o.merge(t||{},i),null===this.options.grid.minorVerticalLines&&"logarithmic"===this.options.xaxis.scaling&&(this.options.grid.minorVerticalLines=!0),null===this.options.grid.minorHorizontalLines&&"logarithmic"===this.options.yaxis.scaling&&(this.options.grid.minorHorizontalLines=!0),e.fire(this.el,"flotr:afterinitoptions",[this]),this.axes=o.Axis.getAxes(this.options);var n,h,a,l,r=[],c=[],u=this.series.length,d=this.series.length,p=this.options.colors,f=[],g=0;for(h=d-1;h>-1;--h)n=this.series[h].color,n&&(--d,s.isNumber(n)?r.push(n):f.push(o.Color.parse(n)));for(h=r.length-1;h>-1;--h)d=Math.max(d,r[h]+1);for(h=0;c.length<d;){n=p.length==h?new o.Color(100,100,100):o.Color.parse(p[h]);var x=g%2==1?-1:1,m=1+x*Math.ceil(g/2)*.2;n.scale(m,m,m),c.push(n),++h>=p.length&&(h=0,++g)}for(h=0,a=0;u>h;++h){l=this.series[h],l.color?s.isNumber(l.color)&&(l.color=c[l.color].toString()):l.color=c[a++].toString(),l.xaxis||(l.xaxis=this.axes.x),1==l.xaxis?l.xaxis=this.axes.x:2==l.xaxis&&(l.xaxis=this.axes.x2),l.yaxis||(l.yaxis=this.axes.y),1==l.yaxis?l.yaxis=this.axes.y:2==l.yaxis&&(l.yaxis=this.axes.y2);for(var v in o.graphTypes)l[v]=s.extend(s.clone(this.options[v]),l[v]);l.mouse=s.extend(s.clone(this.options.mouse),l.mouse),s.isUndefined(l.shadowSize)&&(l.shadowSize=this.options.shadowSize)}},_setEl:function(t){if(!t)throw"The target container doesn't exist";if(t.graph instanceof Graph)t.graph.destroy();else if(!t.clientWidth)throw"The target container must be visible";t.graph=this,this.el=t}},Flotr.Graph=Graph}();