!function(){function t(t,e,a,i,s,n){var o="image/"+t,r=a.getImageData(0,0,i,s),l=new Image;return a.save(),a.globalCompositeOperation="destination-over",a.fillStyle=n,a.fillRect(0,0,i,s),l.src=e.toDataURL(o),a.restore(),a.clearRect(0,0,i,s),a.putImageData(r,0,0),l}var e=Flotr.DOM,a=Flotr._;Flotr.addPlugin("download",{saveImage:function(i,s,n,o){var r,l=this.options.grid;if(Flotr.isIE&&Flotr.isIE<9)return r="<html><body>"+this.canvas.firstChild.innerHTML+"</body></html>",window.open().document.write(r);if("jpeg"===i||"png"===i)return r=t(i,this.canvas,this.ctx,this.canvasWidth,this.canvasHeight,l&&l.backgroundColor||"#ffffff"),a.isElement(r)&&o?(this.download.restoreCanvas(),e.hide(this.canvas),e.hide(this.overlay),e.setStyles({position:"absolute"}),e.insert(this.el,r),this.saveImageElement=r,void 0):window.open(r.src)},restoreCanvas:function(){e.show(this.canvas),e.show(this.overlay),this.saveImageElement&&this.el.removeChild(this.saveImageElement),this.saveImageElement=null}})}();