!function(){function t(t){return t.which?1===t.which:0===t.button||1===t.button}function e(t,e){return Math.min(Math.max(0,t),e.plotWidth-1)}function i(t,e){return Math.min(Math.max(0,t),e.plotHeight)}var s=(Flotr.DOM,Flotr.EventAdapter),n=Flotr._;Flotr.addPlugin("selection",{options:{pinchOnly:null,mode:null,color:"#B6D9FF",fps:20},callbacks:{"flotr:mouseup":function(t){var e=this.options.selection,i=this.selection,s=this.getEventPosition(t);e&&e.mode&&(i.interval&&clearInterval(i.interval),this.multitouches?i.updateSelection():e.pinchOnly||i.setSelectionPos(i.selection.second,s),i.clearSelection(),i.selecting&&i.selectionIsSane()&&(i.drawSelection(),i.fireSelectEvent(),this.ignoreClick=!0))},"flotr:mousedown":function(e){var i=this.options.selection,s=this.selection,o=this.getEventPosition(e);i&&i.mode&&(!i.mode||!t(e)&&n.isUndefined(e.touches)||(i.pinchOnly||s.setSelectionPos(s.selection.first,o),s.interval&&clearInterval(s.interval),this.lastMousePos.pageX=null,s.selecting=!1,s.interval=setInterval(n.bind(s.updateSelection,this),1e3/i.fps)))},"flotr:destroy":function(){clearInterval(this.selection.interval)}},getArea:function(){{var t,e,i,s,n=this.selection.selection,o=this.axes;n.first,n.second}return t=o.x.p2d(n.first.x),e=o.x.p2d(n.second.x),i=o.y.p2d(n.first.y),s=o.y.p2d(n.second.y),{x1:Math.min(t,e),y1:Math.min(i,s),x2:Math.max(t,e),y2:Math.max(i,s),xfirst:t,xsecond:e,yfirst:i,ysecond:s}},selection:{first:{x:-1,y:-1},second:{x:-1,y:-1}},prevSelection:null,interval:null,fireSelectEvent:function(t){var e=this.selection.getArea();t=t||"select",e.selection=this.selection.selection,s.fire(this.el,"flotr:"+t,[e,this])},setSelection:function(t,s){var n=this.options,o=this.axes.x,l=this.axes.y,c=l.scale,r=o.scale,h=-1!=n.selection.mode.indexOf("x"),a=-1!=n.selection.mode.indexOf("y"),f=this.selection.selection;this.selection.clearSelection(),f.first.y=i(h&&!a?0:(l.max-t.y1)*c,this),f.second.y=i(h&&!a?this.plotHeight-1:(l.max-t.y2)*c,this),f.first.x=e(a&&!h?0:(t.x1-o.min)*r,this),f.second.x=e(a&&!h?this.plotWidth:(t.x2-o.min)*r,this),this.selection.drawSelection(),s||this.selection.fireSelectEvent()},setSelectionPos:function(t,s){var n=this.options.selection.mode,o=this.selection.selection;t.x=-1==n.indexOf("x")?t==o.first?0:this.plotWidth:e(s.relX,this),t.y=-1==n.indexOf("y")?t==o.first?0:this.plotHeight-1:i(s.relY,this)},drawSelection:function(){this.selection.fireSelectEvent("selecting");var t=this.selection.selection,e=this.octx,i=this.options,s=this.plotOffset,n=this.selection.prevSelection;if(!n||t.first.x!=n.first.x||t.first.y!=n.first.y||t.second.x!=n.second.x||t.second.y!=n.second.y){e.save(),e.strokeStyle=this.processColor(i.selection.color,{opacity:.8}),e.lineWidth=1,e.lineJoin="miter",e.fillStyle=this.processColor(i.selection.color,{opacity:.4}),this.selection.prevSelection={first:{x:t.first.x,y:t.first.y},second:{x:t.second.x,y:t.second.y}};var o=Math.min(t.first.x,t.second.x),l=Math.min(t.first.y,t.second.y),c=Math.abs(t.second.x-t.first.x),r=Math.abs(t.second.y-t.first.y);e.fillRect(o+s.left+.5,l+s.top+.5,c,r),e.strokeRect(o+s.left+.5,l+s.top+.5,c,r),e.restore()}},updateSelection:function(){if(this.lastMousePos.pageX){if(this.selection.selecting=!0,this.multitouches)this.selection.setSelectionPos(this.selection.selection.first,this.getEventPosition(this.multitouches[0])),this.selection.setSelectionPos(this.selection.selection.second,this.getEventPosition(this.multitouches[1]));else{if(this.options.selection.pinchOnly)return;this.selection.setSelectionPos(this.selection.selection.second,this.lastMousePos)}this.selection.clearSelection(),this.selection.selectionIsSane()&&this.selection.drawSelection()}},clearSelection:function(){if(this.selection.prevSelection){var t=this.selection.prevSelection,e=1,i=this.plotOffset,s=Math.min(t.first.x,t.second.x),n=Math.min(t.first.y,t.second.y),o=Math.abs(t.second.x-t.first.x),l=Math.abs(t.second.y-t.first.y);this.octx.clearRect(s+i.left-e+.5,n+i.top-e,o+2*e+.5,l+2*e+.5),this.selection.prevSelection=null}},selectionIsSane:function(){var t=this.selection.selection;return Math.abs(t.second.x-t.first.x)>=5||Math.abs(t.second.y-t.first.y)>=5}})}();