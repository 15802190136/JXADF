!function(){function t(t){if(this.options.spreadsheet.tickFormatter)return this.options.spreadsheet.tickFormatter(t);var e=a.find(this.axes.x.ticks,function(e){return e.v==t});return e?e.label:t}var e=Flotr.DOM,a=Flotr._;Flotr.addPlugin("spreadsheet",{options:{show:!1,tabGraphLabel:"Graph",tabDataLabel:"Data",toolbarDownload:"Download CSV",toolbarSelectAll:"Select all",csvFileSeparator:",",decimalSeparator:".",tickFormatter:null,initialTab:"graph"},callbacks:{"flotr:afterconstruct":function(){if(this.options.spreadsheet.show){var t,a=this.spreadsheet,s=e.node('<div class="flotr-tabs-group" style="position:absolute;left:0px;width:'+this.canvasWidth+'px"></div>'),r=e.node('<div style="float:left" class="flotr-tab selected">'+this.options.spreadsheet.tabGraphLabel+"</div>"),i=e.node('<div style="float:left" class="flotr-tab">'+this.options.spreadsheet.tabDataLabel+"</div>");a.tabsContainer=s,a.tabs={graph:r,data:i},e.insert(s,r),e.insert(s,i),e.insert(this.el,s),t=e.size(i).height+2,this.plotOffset.bottom+=t,e.setStyles(s,{top:this.canvasHeight-t+"px"}),this.observe(r,"click",function(){a.showTab("graph")}).observe(i,"click",function(){a.showTab("data")}),"graph"!==this.options.spreadsheet.initialTab&&a.showTab(this.options.spreadsheet.initialTab)}}},loadDataGrid:function(){if(this.seriesData)return this.seriesData;var t=this.series,e={};return a.each(t,function(t,s){a.each(t.data,function(t){var a=t[0],r=t[1],i=e[a];if(i)i[s+1]=r;else{var o=[];o[0]=a,o[s+1]=r,e[a]=o}})}),this.seriesData=a.sortBy(e,function(t,e){return parseInt(e,10)}),this.seriesData},constructDataGrid:function(){if(this.spreadsheet.datagrid)return this.spreadsheet.datagrid;var s,r,i,o=this.series,n=this.spreadsheet.loadDataGrid(),h=["<colgroup><col />"],d=['<table class="flotr-datagrid"><tr class="first-row">'];d.push("<th>&nbsp;</th>"),a.each(o,function(t,e){d.push('<th scope="col">'+(t.label||String.fromCharCode(65+e))+"</th>"),h.push("<col />")}),d.push("</tr>"),a.each(n,function(e){d.push("<tr>"),a.times(o.length+1,function(s){var r="td",i=e[s],o=a.isUndefined(i)?"":Math.round(1e5*i)/1e5;if(0===s){r="th";var n=t.call(this,o);n&&(o=n)}d.push("<"+r+("th"==r?' scope="row"':"")+">"+o+"</"+r+">")},this),d.push("</tr>")},this),h.push("</colgroup>"),i=e.node(d.join("")),s=e.node('<button type="button" class="flotr-datagrid-toolbar-button">'+this.options.spreadsheet.toolbarDownload+"</button>"),r=e.node('<button type="button" class="flotr-datagrid-toolbar-button">'+this.options.spreadsheet.toolbarSelectAll+"</button>"),this.observe(s,"click",a.bind(this.spreadsheet.downloadCSV,this)).observe(r,"click",a.bind(this.spreadsheet.selectAllData,this));var l=e.node('<div class="flotr-datagrid-toolbar"></div>');e.insert(l,s),e.insert(l,r);var c=this.canvasHeight-e.size(this.spreadsheet.tabsContainer).height-2,p=e.node('<div class="flotr-datagrid-container" style="position:absolute;left:0px;top:0px;width:'+this.canvasWidth+"px;height:"+c+'px;overflow:auto;z-index:10"></div>');return e.insert(p,l),e.insert(p,i),e.insert(this.el,p),this.spreadsheet.datagrid=i,this.spreadsheet.container=p,i},showTab:function(t){if(this.spreadsheet.activeTab!==t){switch(t){case"graph":e.hide(this.spreadsheet.container),e.removeClass(this.spreadsheet.tabs.data,"selected"),e.addClass(this.spreadsheet.tabs.graph,"selected");break;case"data":this.spreadsheet.datagrid||this.spreadsheet.constructDataGrid(),e.show(this.spreadsheet.container),e.addClass(this.spreadsheet.tabs.data,"selected"),e.removeClass(this.spreadsheet.tabs.graph,"selected");break;default:throw"Illegal tab name: "+t}this.spreadsheet.activeTab=t}},selectAllData:function(){if(this.spreadsheet.tabs){var t,e,a,s,r=this.spreadsheet.constructDataGrid();return this.spreadsheet.showTab("data"),setTimeout(function(){(a=r.ownerDocument)&&(s=a.defaultView)&&s.getSelection&&a.createRange&&(t=window.getSelection())&&t.removeAllRanges?(e=a.createRange(),e.selectNode(r),t.removeAllRanges(),t.addRange(e)):document.body&&document.body.createTextRange&&(e=document.body.createTextRange())&&(e.moveToElementText(r),e.select())},0),!0}return!1},downloadCSV:function(){var e="",s=this.series,r=this.options,i=this.spreadsheet.loadDataGrid(),o=encodeURIComponent(r.spreadsheet.csvFileSeparator);if(r.spreadsheet.decimalSeparator===r.spreadsheet.csvFileSeparator)throw"The decimal separator is the same as the column separator ("+r.spreadsheet.decimalSeparator+")";a.each(s,function(t,a){e+=o+'"'+(t.label||String.fromCharCode(65+a)).replace(/\"/g,'\\"')+'"'}),e+="%0D%0A",e+=a.reduce(i,function(e,a){var s=t.call(this,a[0])||"";s='"'+(s+"").replace(/\"/g,'\\"')+'"';var i=a.slice(1).join(o);return"."!==r.spreadsheet.decimalSeparator&&(i=i.replace(/\./g,r.spreadsheet.decimalSeparator)),e+s+o+i+"%0D%0A"},"",this),Flotr.isIE&&Flotr.isIE<9?(e=e.replace(new RegExp(o,"g"),decodeURIComponent(o)).replace(/%0A/g,"\n").replace(/%0D/g,"\r"),window.open().document.write(e)):window.open("data:text/csv,"+e)}})}();