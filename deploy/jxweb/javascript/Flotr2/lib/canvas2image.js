var Canvas2Image=function(){var t=document.createElement("canvas"),e=String.fromCharCode,a="image/octet-stream",r=!1;if(!t.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var n=!!t.getContext("2d").getImageData,o=!!t.toDataURL,i=!!window.btoa,f=function(t){var e=parseInt(t.width),a=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,a)},u=function(t){var a,r,n="";if("string"==typeof t)n=t;else for(r=t,a=0;a<r.length;a++)n+=e(r[a]);return btoa(n)},h=function(t){var a="",r=t.width,n=t.height;a+="BM";var o=r*n*4+54;a+=e(o%256),o=Math.floor(o/256),a+=e(o%256),o=Math.floor(o/256),a+=e(o%256),o=Math.floor(o/256),a+=e(o%256),a+=e(0,0,0,0,54,0,0,0),a+=e(40,0,0,0);var i=r;a+=e(i%256),i=Math.floor(i/256),a+=e(i%256),i=Math.floor(i/256),a+=e(i%256),i=Math.floor(i/256),a+=e(i%256);var f=n;a+=e(f%256),f=Math.floor(f/256),a+=e(f%256),f=Math.floor(f/256),a+=e(f%256),f=Math.floor(f/256),a+=e(f%256),a+=e(1,0,32,0),a+=e(0,0,0,0);var h=r*n*4;a+=e(h%256),h=Math.floor(h/256),a+=e(h%256),h=Math.floor(h/256),a+=e(h%256),h=Math.floor(h/256),a+=e(h%256),a+=e(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var c,v,g,s,l=t.data,d="",m=n;do{for(g=r*(m-1)*4,s="",c=0;r>c;c++)v=4*c,s+=e(l[g+v+2],l[g+v+1],l[g+v],l[g+v+3]);d+=s}while(--m);return u(a+d)},c=function(t){window.open(t)||(document.location.href=t)},v=function(t,e){return"data:"+e+";base64,"+t},g=function(t){var e=document.createElement("img");return e.src=t,e},s=function(t,e,a){if(e&&a){var r=document.createElement("canvas");r.width=e,r.height=a,r.style.width=e+"px",r.style.height=a+"px";var n=r.getContext("2d");return n.drawImage(t,0,0,t.width,t.height,0,0,e,e),r}return t};return{saveAsPNG:function(t,e,n,i){if(!o)return!1;var f=s(t,n,i),u="image/png",h=f.toDataURL(u);return e?g(h):(c(r?h.replace(u,a):h),!0)},saveAsJPEG:function(t,e,n,i){if(!o)return!1;var f=s(t,n,i),u="image/jpeg",h=f.toDataURL(u);return 5!=h.indexOf(u)?!1:e?g(h):(c(r?h.replace(u,a):h),!0)},saveAsBMP:function(t,e,a,r){if(!(o&&n&&i))return!1;var u=s(t,a,r),l="image/bmp",d=f(u),m=h(d);return e?g(v(m,l)):(c(v(m,l)),!0)}}}();