!function(t,e){var n=this;"undefined"!=typeof module?module.exports=e():"function"==typeof define&&"object"==typeof define.amd?define(e):n[t]=e(n,t)}("imagediff",function(t,e){function n(t,e){var n=document.createElement("canvas");return t&&(n.width=t),e&&(n.height=e),n}function a(t,e){return H.width=t,H.height=e,L.clearRect(0,0,t,e),L.createImageData(t,e)}function i(t){return d(t,q)}function r(t){return d(t,E)}function u(t){return d(t,T)}function h(t){var e=a(1,1);return(h=function(t){return t&&e.constructor===t.constructor?!0:!1})(t)}function o(t){return i(t)||r(t)||u(t)||h(t)}function d(t,e){return"object"==typeof t&&Object.prototype.toString.apply(t)===e}function c(t){var e=t.height,n=t.width;return H.width=n,H.height=e,L.putImageData(t,0,0),L.getImageData(0,0,n,e)}function f(t){return i(t)?g(t):r(t)?m(t):u(t)?s(t):h(t)?t:void 0}function g(t){var e=t.height,n=t.width;return H.width=n,H.height=e,L.clearRect(0,0,n,e),L.drawImage(t,0,0),L.getImageData(0,0,n,e)}function m(t){var e=t.height,n=t.width,a=t.getContext("2d");return a.getImageData(0,0,n,e)}function s(t){var e=t.canvas,n=e.height,a=e.width;return t.getImageData(0,0,a,n)}function l(t){var e=f(t),a=n(e.width,e.height),i=a.getContext("2d");return i.putImageData(e,0,0),a}function v(t,e){return t.width===e.width}function p(t,e){return t.height===e.height}function w(t,e){return p(t,e)&&v(t,e)}function I(t,e,n){var a,i=t.data,r=e.data,u=i.length,n=n||0;if(!w(t,e))return!1;for(a=u;a--;)if(i[a]!==r[a]&&Math.abs(i[a]-r[a])>n)return!1;return!0}function b(t,e){return(w(t,e)?C:D)(t,e)}function C(t,e){var n,i=t.height,r=t.width,u=a(r,i),h=t.data,o=e.data,d=u.data,c=d.length;for(n=0;c>n;n+=4)d[n]=Math.abs(h[n]-o[n]),d[n+1]=Math.abs(h[n+1]-o[n+1]),d[n+2]=Math.abs(h[n+2]-o[n+2]),d[n+3]=Math.abs(255-h[n+3]-o[n+3]);return u}function D(t,e){function n(t){i=Math.floor((c-t.height)/2),r=Math.floor((f-t.width)/2)}var i,r,u,h,o,d,c=Math.max(t.height,e.height),f=Math.max(t.width,e.width),g=a(f,c),m=t.data,s=e.data,l=g.data;for(o=l.length-1;o>0;o-=4)l[o]=255;for(n(t),u=t.height;u--;)for(h=t.width;h--;)o=4*((u+i)*f+(h+r)),d=4*(u*t.width+h),l[o+0]=m[d+0],l[o+1]=m[d+1],l[o+2]=m[d+2];for(n(e),u=e.height;u--;)for(h=e.width;h--;)o=4*((u+i)*f+(h+r)),d=4*(u*e.width+h),l[o+0]=Math.abs(l[o+0]-s[d+0]),l[o+1]=Math.abs(l[o+1]-s[d+1]),l[o+2]=Math.abs(l[o+2]-s[d+2]);return g}function M(){var t;for(t=0;t<arguments.length;t++)if(!o(arguments[t]))throw{name:"ImageTypeError",message:"Submitted object was not an image."}}function x(t,e){return t=document.createElement(t),t&&e&&(t.innerHTML=e),t}var j,y,E="[object HTMLCanvasElement]",T="[object CanvasRenderingContext2D]",q="[object HTMLImageElement]",H=n(),L=H.getContext("2d"),R=t[e];return y={toBeImageData:function(){return j.isImageData(this.actual)},toImageDiffEqual:function(t,e){return this.message=function(){var e,a=x("div"),i=x("div","<div>Actual:</div>"),r=x("div","<div>Expected:</div>"),u=x("div","<div>Diff:</div>"),h=j.diff(this.actual,t),o=n();return o.height=h.height,o.width=h.width,e=o.getContext("2d"),e.putImageData(h,0,0),i.appendChild(l(this.actual)),r.appendChild(l(t)),u.appendChild(o),a.appendChild(i),a.appendChild(r),a.appendChild(u),[a,"Expected not to be equal."]},j.equal(this.actual,t,e)}},j={createCanvas:n,createImageData:a,isImage:i,isCanvas:r,isContext:u,isImageData:h,isImageType:o,toImageData:function(t){return M(t),h(t)?c(t):f(t)},equal:function(t,e,n){return M(t,e),t=f(t),e=f(e),I(t,e,n)},diff:function(t,e){return M(t,e),t=f(t),e=f(e),b(t,e)},jasmine:y,noConflict:function(){return t[e]=R,j}}});