!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","echarts"],e):e($,echarts)}(function(e,t){"use strict";e.widget("mn.sDashboard",{version:"2.5",options:{dashboardData:[]},_create:function(){this.element.addClass("sDashboard"),this._createView()},_setOption:function(e,t){this.options[e]=t,"dashboardData"===e&&this._createView()},_createView:function(){var t=e(document).height(),a=this,i=e(".sDashboard-overlay");i.length||(i=e("<div class='sDashboard-overlay'></div>").appendTo("body")),i.height(t),i.hide(),this.element.on("sDashboard.addWidget",function(t,i,d){e.isFunction(a.options.onWidgetAdded)&&a.options.onWidgetAdded(i,d)});var d,r=this.options.dashboardData;for(d=0;d<r.length;d++){var s=this._constructWidget(r[d]);this.element.append(s),this._renderChart(r[d]),this.element.trigger("sDashboard.addWidget",[r[d],s])}this.element.sortable({handle:".sDashboardWidgetHeader",update:function(){a.element.trigger("sdashboardorderchanged",a)}});var n=this.options.hasOwnProperty("disableSelection")?this.options.disableSelection:!0;n&&this.element.disableSelection(),this._bindEvents(),this._trigger("creationComplete",null)},_getWidgetContentForId:function(e,t){for(var a=t.getDashboardData(),i=0;i<a.length;i++){var d=a[i];if(d.widgetId===e)return d}return[]},_bindEvents:function(){var t=this;this.element.on("click",".sDashboardWidgetHeader div.sDashboard-icon.sDashboard-circle-plus-icon",function(a){var i=e(a.currentTarget),d=i.parents("li:first"),r=i.parents(".sDashboardWidget:first"),s=r.find(".sDashboardWidgetContent"),n=t._getWidgetContentForId(d.attr("id"),t);i.toggleClass("sDashboard-circle-minus-icon"),"Maximize"===i.attr("title")?(e(".sDashboard-overlay").show(),i.attr("title","Minimize"),t._trigger("widgetMaximized",null,{widgetDefinition:n})):(e(".sDashboard-overlay").hide(),i.attr("title","Maximize"),t._trigger("widgetMinimized",null,{widgetDefinition:n})),r.toggleClass("sDashboardWidgetContainerMaximized"),s.toggleClass("sDashboardWidgetContentMaximized "),t.element.trigger("sDashboard.zoom",d)}),this.element.on("click",".sDashboardWidgetHeader div.sDashboard-icon.sDashboard-refresh-icon",function(a){var i=e(a.currentTarget).parents("li:first"),d=i.attr("id"),r=t._getWidgetContentForId(d,t),s=r.refreshCallBack.apply(t,[d]);r.widgetContent=s,"chart"===r.widgetType?t._renderChart(r):"table"===r.widgetType?t._refreshTable(r,i):t._refreshRegularWidget(r,i)}),this.element.on("click",".sDashboardWidgetHeader div.sDashboard-icon.sDashboard-circle-del-icon ",function(a){var i=e(a.currentTarget).parents("li:first");t.element.trigger("sDashboard.removeWidget",i)}),this.element.on("click",".sDashboardWidgetContent table.sDashboardTableView tbody tr",function(a){var i=e(a.currentTarget);if(i.length>0){var d=i.parents("table:first").dataTable(),r=i.parents("li:first"),s=d.fnGetData(i[0]),n=r.attr("id"),o={selectedRowData:s,selectedWidgetId:n};t._trigger("rowclicked",null,o)}})},_constructWidget:function(t){var a=e("<li/>").attr("id",t.widgetId),i=e("<div/>").addClass("sDashboardWidget"),d=e("<div/>").addClass("sDashboardWidgetHeader sDashboard-clearfix"),r=e('<div title="Maximize" class="sDashboard-icon sDashboard-circle-plus-icon "></span>'),s=e('<div title="Remove" class="sDashboard-icon sDashboard-circle-del-icon"></div>');if(a.attr("column",t.column),d.append(s),d.append(r),t.hasOwnProperty("enableRefresh")&&t.enableRefresh){var n=e('<div title="Refresh" class="sDashboard-icon sDashboard-refresh-icon "></div>');d.append(n)}d.append(t.widgetTitle);var o=e("<div/>").addClass("sDashboardWidgetContent");if("table"===t.widgetType){var l={aaData:t.widgetContent.aaData,aoColumns:t.widgetContent.aoColumns};t.setJqueryStyle&&(l.bJQueryUI=!0);var h=e('<table cellpadding="0" cellspacing="0" border="0" class="display sDashboardTableView table table-bordered"></table>').dataTable(l);o.append(h)}else if("chart"===t.widgetType){var g=e("<div/>").addClass("sDashboardChart");g.addClass(t.getDataBySelection?"sDashboardChartSelectable":"sDashboardChartClickable"),a.addClass("chart"),o.append(g)}else o.append(t.widgetContent);return i.append(d),i.append(o),a.append(i),a},_refreshRegularWidget:function(t,a){var i=a.find(".sDashboardWidgetContent").hasClass("sDashboardWidgetContentMaximized");a.find(".sDashboardWidgetContent").empty().remove();var d=e("<div/>").addClass("sDashboardWidgetContent");i&&d.addClass("sDashboardWidgetContentMaximized"),d.append(t.widgetContent),a.find(".sDashboardWidget").append(d)},_refreshTable:function(e,t){var a=t.find("table:first").dataTable();a.fnClearTable(),a.fnAddData(e.widgetContent.aaData)},_rebuildPieRenderOption:function(t,a){var i=a.width();return 650>i?e.each(t,function(e,t){t.itemStyle={normal:{label:{show:!1},labelLine:{show:!1}}}}):e.each(t,function(e,t){t.itemStyle={normal:{label:{show:!0},labelLine:{show:!0}}}}),t},_renderChart:function(a){var i,d="li#"+a.widgetId;if("chart"===a.widgetType){i=this.element.find(d+" div.sDashboardChart");var r=t.init(i.get(0));"pie"==a.type&&r.on("resize",e.proxy(function(){var e=r.getSeries();this._rebuildPieRenderOption(e,i),r.setSeries(e)},this)),this._rebuildPieRenderOption(a.widgetContent.series,i),r.setOption(a.widgetContent,!0),dashboardList.addDashboardChart(a.widgetId,r)}},_removeWidgetFromWidgetDefinitions:function(e){var t=this.options.dashboardData;for(var a in t){var i=t[a].widgetId;if(i===e){t.splice(a,1);break}}},_ifWidgetAlreadyExists:function(e){if(!e)throw"Expected widgetId to be defined";var t="#"+e,a=this.element.find("li"+t);return a.length>0?!0:!1},addWidget:function(e){if(!e.widgetId)throw"Expected widgetId to be defined";if(this._ifWidgetAlreadyExists(e.widgetId))this.element.find("li#"+e.widgetId).effect("shake",{times:3},800);else{this.options.dashboardData.push(e);var t=this._constructWidget(e),a=this.element.find("li[column="+e.column+"]");a.length?e.widgetId.indexOf("empty")>-1?a.last().after(t):-1==e.order?a.first().before(t):a.last().before(t):this.element.append(t),this._renderChart(e),this.element.trigger("sDashboard.addWidget",[e,t])}},removeWidget:function(e){if(!e)throw"Expected widgetId to be defined";var t="#"+e,a=this.element.find("li"+t);a.length>0&&(this.element.find("li"+t).remove(),this._removeWidgetFromWidgetDefinitions(e))},getDashboardData:function(){return this.options.dashboardData},destroy:function(){e(".sDashboard-overlay").remove(),e.Widget.prototype.destroy.call(this)}})});