(function(a){if(typeof define==="function"&&define.amd){define(["jquery","echarts"],a)}else{a($,echarts)}}(function(b,a){b.widget("mn.sDashboard",{version:"2.5",options:{dashboardData:[]},_create:function(){this.element.addClass("sDashboard");this._createView()},_setOption:function(c,d){this.options[c]=d;if(c==="dashboardData"){this._createView()}},_createView:function(){var d=b(document).height();var g=this;var e=b(".sDashboard-overlay");if(!e.length){e=b("<div class='sDashboard-overlay'></div>").appendTo("body")}e.height(d);e.hide();this.element.on("sDashboard.addWidget",function(i,l,k){if(b.isFunction(g.options.onWidgetAdded)){g.options.onWidgetAdded(l,k)}});var j=this.options.dashboardData;var f;for(f=0;f<j.length;f++){var h=this._constructWidget(j[f]);this.element.append(h);this._renderChart(j[f]);this.element.trigger("sDashboard.addWidget",[j[f],h])}this.element.sortable({handle:".sDashboardWidgetHeader",update:function(){g.element.trigger("sdashboardorderchanged",g)}});var c=this.options.hasOwnProperty("disableSelection")?this.options.disableSelection:true;if(c){this.element.disableSelection()}this._bindEvents();this._trigger("creationComplete",null)},_getWidgetContentForId:function(g,d){var f=d.getDashboardData();for(var c=0;c<f.length;c++){var e=f[c];if(e.widgetId===g){return e}}return[]},_bindEvents:function(){var c=this;this.element.on("click",".sDashboardWidgetHeader div.sDashboard-icon.sDashboard-circle-plus-icon",function(j){var i=b(j.currentTarget);var h=i.parents("li:first");var g=i.parents(".sDashboardWidget:first");var f=g.find(".sDashboardWidgetContent");var d=c._getWidgetContentForId(h.attr("id"),c);i.toggleClass("sDashboard-circle-minus-icon");if(i.attr("title")==="Maximize"){b(".sDashboard-overlay").show();i.attr("title","Minimize");c._trigger("widgetMaximized",null,{widgetDefinition:d})}else{b(".sDashboard-overlay").hide();i.attr("title","Maximize");c._trigger("widgetMinimized",null,{widgetDefinition:d})}g.toggleClass("sDashboardWidgetContainerMaximized");f.toggleClass("sDashboardWidgetContentMaximized ");c.element.trigger("sDashboard.zoom",h)});this.element.on("click",".sDashboardWidgetHeader div.sDashboard-icon.sDashboard-refresh-icon",function(i){var h=b(i.currentTarget).parents("li:first");var g=h.attr("id");var f=c._getWidgetContentForId(g,c);var d=f.refreshCallBack.apply(c,[g]);f.widgetContent=d;if(f.widgetType==="chart"){c._renderChart(f)}else{if(f.widgetType==="table"){c._refreshTable(f,h)}else{c._refreshRegularWidget(f,h)}}});this.element.on("click",".sDashboardWidgetHeader div.sDashboard-icon.sDashboard-circle-del-icon ",function(f){var d=b(f.currentTarget).parents("li:first");c.element.trigger("sDashboard.removeWidget",d)});this.element.on("click",".sDashboardWidgetContent table.sDashboardTableView tbody tr",function(j){var h=b(j.currentTarget);if(h.length>0){var g=h.parents("table:first").dataTable();var i=h.parents("li:first");var f=g.fnGetData(h[0]);var k=i.attr("id");var d={selectedRowData:f,selectedWidgetId:k};c._trigger("rowclicked",null,d)}})},_constructWidget:function(g){var f=b("<li/>").attr("id",g.widgetId);var c=b("<div/>").addClass("sDashboardWidget");var l=b("<div/>").addClass("sDashboardWidgetHeader sDashboard-clearfix");var j=b('<div title="Maximize" class="sDashboard-icon sDashboard-circle-plus-icon "></span>');var i=b('<div title="Remove" class="sDashboard-icon sDashboard-circle-del-icon"></div>');f.attr("column",g.column);l.append(i);l.append(j);if(g.hasOwnProperty("enableRefresh")&&g.enableRefresh){var m=b('<div title="Refresh" class="sDashboard-icon sDashboard-refresh-icon "></div>');l.append(m)}l.append(g.widgetTitle);var k=b("<div/>").addClass("sDashboardWidgetContent");if(g.widgetType==="table"){var e={aaData:g.widgetContent.aaData,aoColumns:g.widgetContent.aoColumns};if(g.setJqueryStyle){e.bJQueryUI=true}var d=b('<table cellpadding="0" cellspacing="0" border="0" class="display sDashboardTableView table table-bordered"></table>').dataTable(e);k.append(d)}else{if(g.widgetType==="chart"){var h=b("<div/>").addClass("sDashboardChart");if(g.getDataBySelection){h.addClass("sDashboardChartSelectable")}else{h.addClass("sDashboardChartClickable")}f.addClass("chart");k.append(h)}else{k.append(g.widgetContent)}}c.append(l);c.append(k);f.append(c);return f},_refreshRegularWidget:function(e,f){var d=f.find(".sDashboardWidgetContent").hasClass("sDashboardWidgetContentMaximized");f.find(".sDashboardWidgetContent").empty().remove();var c=b("<div/>").addClass("sDashboardWidgetContent");if(d){c.addClass("sDashboardWidgetContentMaximized")}c.append(e.widgetContent);f.find(".sDashboardWidget").append(c)},_refreshTable:function(d,e){var c=e.find("table:first").dataTable();c.fnClearTable();c.fnAddData(d.widgetContent.aaData)},_rebuildPieRenderOption:function(d,e){var c=e.width();if(c<650){b.each(d,function(f,g){g.itemStyle={normal:{label:{show:false},labelLine:{show:false}}}})}else{b.each(d,function(f,g){g.itemStyle={normal:{label:{show:true},labelLine:{show:true}}}})}return d},_renderChart:function(c){var f="li#"+c.widgetId;var e;if(c.widgetType==="chart"){e=this.element.find(f+" div.sDashboardChart");var d=a.init(e.get(0));if(c.type=="pie"){d.on("resize",b.proxy(function(){var g=d.getSeries();this._rebuildPieRenderOption(g,e);d.setSeries(g)},this))}this._rebuildPieRenderOption(c.widgetContent.series,e);d.setOption(c.widgetContent,true);dashboardList.addDashboardChart(c.widgetId,d)}},_removeWidgetFromWidgetDefinitions:function(f){var d=this.options.dashboardData;for(var e in d){var c=d[e].widgetId;if(c===f){d.splice(e,1);break}}},_ifWidgetAlreadyExists:function(c){if(!c){throw"Expected widgetId to be defined"}var e="#"+c;var d=this.element.find("li"+e);if(d.length>0){return true}return false},addWidget:function(d){if(!d.widgetId){throw"Expected widgetId to be defined"}if(this._ifWidgetAlreadyExists(d.widgetId)){this.element.find("li#"+d.widgetId).effect("shake",{times:3},800)}else{this.options.dashboardData.push(d);var e=this._constructWidget(d);var c=this.element.find("li[column="+d.column+"]");if(c.length){if(d.widgetId.indexOf("empty")>-1){c.last().after(e)}else{if(d.order==-1){c.first().before(e)}else{c.last().before(e)}}}else{this.element.append(e)}this._renderChart(d);this.element.trigger("sDashboard.addWidget",[d,e])}},removeWidget:function(c){if(!c){throw"Expected widgetId to be defined"}var e="#"+c;var d=this.element.find("li"+e);if(d.length>0){this.element.find("li"+e).remove();this._removeWidgetFromWidgetDefinitions(c)}},getDashboardData:function(){return this.options.dashboardData},destroy:function(){b(".sDashboard-overlay").remove();b.Widget.prototype.destroy.call(this)}})}));