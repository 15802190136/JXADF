var sUserAgent=navigator.userAgent.toLowerCase();var bIsIpad=sUserAgent.match(/ipad/i)=="ipad";var bIsIphoneOs=sUserAgent.match(/iphone os/i)=="iphone os";var bIsMidp=sUserAgent.match(/midp/i)=="midp";var bIsUc7=sUserAgent.match(/rv:1.2.3.4/i)=="rv:1.2.3.4";var bIsUc=sUserAgent.match(/ucweb/i)=="ucweb";var bIsAndroid=sUserAgent.match(/android/i)=="android";var bIsCE=sUserAgent.match(/windows ce/i)=="windows ce";var bIsWM=sUserAgent.match(/windows mobile/i)=="windows mobile";var bIsIE=sUserAgent.match(/msie/i)=="msie";var bIsChrome=sUserAgent.match(/chrome/i)=="chrome";var bIsFireFox=sUserAgent.match(/firefox/i)=="firefox";function debug(a){if(window.console&&window.console.log){window.console.info(a)}}function isMobile(){if(/AppleWebKit.*Mobile/i.test(navigator.userAgent)||(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))){if(window.location.href.indexOf("?mobile")<0){try{if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)){return true}else{return false}}catch(a){}}}return false}function isBootstrapRender(){return top.location.search&&top.location.search.indexOf("renderer=bootstrap")>-1}function resizeDialogWhenFrame(j){if(!JxUtil.isTopWindow()&&window.$currentDialog){if($currentDialog.dialog("isOpen")){if(j&&window.resizeRequired){if(window.resizeWidth&&window.resizeWidth!=window.initWidth){$currentDialog.dialog("option","width",window.initWidth)}if(window.resizeWidth&&window.resizeHeight!=window.initHeight){$currentDialog.dialog("option","height",window.initHeight)}}else{var g=$(document);var h=$(window);var c=g.width();var f=g.height();var b=h.width();var e=h.height();var a=$(parent.window);window.resizeRequired=(c<a.width()-100)||(f<a.height()-10);if(window.resizeRequired){if(c>b){window.resizeWidth=c>window.initWidth?c+30:window.initWidth;$currentDialog.dialog("option","width",window.resizeWidth)}if(f>e){window.resizeHeight=f>window.initHeight?f+60:window.initHeight;$currentDialog.dialog("option","height",window.resizeHeight)}}}}}}var JxUtil={extend:function(b,c,a){if(a){return function(){b.apply(this,arguments);c.apply(this,arguments)}}else{return function(){c.apply(this,arguments)}}},formatDate:function(b,e){b=b+"";var a="";var f={};f.Jan="01";f.Feb="02";f.Mar="03";f.Apr="04";f.May="05";f.Jun="06";f.Jul="07";f.Aug="08";f.Sep="09";f.Oct="10";f.Nov="11";f.Dec="12";var c={};c.Mon="一";c.Tue="二";c.Wed="三";c.Thu="四";c.Fri="五";c.Sat="六";c.Sun="日";var g=b.split(" ");if(b.indexOf("GMT")>0){a=g[3]+"-";a=a+f[g[1]]+"-"+g[2];if(e=="dateTime"){a+=" "+g[4]}}else{if(b.indexOf("UTC")>0){a=g[5]+"-";a=a+f[g[1]]+"-"+g[2];if(e=="dateTime"){a+=" "+g[3]}}}return a},getClientWidth:function(){var a=0;if(document.body.clientWidth&&document.documentElement.clientWidth){a=(document.body.clientWidth<document.documentElement.clientWidth)?document.body.clientWidth:document.documentElement.clientWidth}else{a=(document.body.clientWidth>document.documentElement.clientWidth)?document.body.clientWidth:document.documentElement.clientWidth}return a},getClientHeight:function(){var a=0;if(document.body.clientHeight&&document.documentElement.clientHeight){a=(document.body.clientHeight<document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight}else{a=(document.body.clientHeight>document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight}return a},getScroll:function(e){if(e&&e.length>1){debug("只能对指定的单一元素进行判断");return}var c=$(e);var a=false;var b=false;if(c.is("html")||c.is("body")){a=$("body")[0].scrollWidth>$(window).width();b=$("body")[0].scrollHeight>$(window).height()}else{a=e.scrollWidth>e.clientWidth;b=e.scrollHeight>e.clientHeight}return{scrollX:a,scrollY:b}},getByteLen:function(c){c=c.replace(/\./g,"").replace(/\,/g,"");var a=0;for(var b=0;b<c.length;b++){if(c[b].match(/[^\x00-\xff]/ig)!=null){a+=2}else{a+=1}}return a},getByteVal:function(f,a){f=f.replace(/\./g,"").replace(/\,/g,"");var e="";var b=0;for(var c=0;c<f.length;c++){if(f[c].match(/[^\x00-\xff]/ig)!=null){b+=2}else{b+=1}if(b>a){break}e+=f[c]}return e},isTopWindow:function(){return window.top==window.self},adjustNumToFixString:function(a,f){var e;a=a.toString();if(a.length>f){e=new RegExp("\\d{"+f+"}$");return a.match(e)[0]}else{if(a.length==f){return a}else{var c=f-a.length;var g="";for(var b=0;b<c;b++){g+="0"}return g+a}}},isExpandContext:false,expandSourceRow:null};function loadJs(a){if((typeof(JsAndCssList)=="undefined")||(JsAndCssList.indexOf("["+a+"]")==-1)){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);if(typeof b!="undefined"){document.getElementsByTagName("head")[0].appendChild(b);JsAndCssList=window.JsAndCssList+"["+a+"]"}}}function loadCss(a){if(JsAndCssList.indexOf("["+a+"]")==-1){var b=document.createElement_x("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);if(typeof b!="undefined"){document.getElementsByTagName_r("head")[0].appendChild(b);JsAndCssList+="["+a+"]"}}}function errorHandler(b,a){if(b==null||b==""||b=="Error"){alert(getLangString("jxcommon.unknowerror"))}else{if(b.indexOf("Incomplete reply from server")>=0){}else{alert(b)}}}function exceptionHandler(b,a){if(b==null||b==""||b=="Error"){alert(getLangString("jxcommon.unknowerror"))}else{alert(b)}}function msgTip(g,f){if(g==""||g=="null"||g==null){return}var b=10;var a=$("<div class='dialog' id='dialog-message'></div>");var e=$("<span class='ui-icon ui-icon-circle-check' style='float: left; margin: 0 7px 0 0;'></span>");var c=$("<p></p>");c.text(g);a.append(e).append(c);a[0].timerMax=b||3;return a.dialog({resizable:false,modal:true,show:{effect:"fade",duration:300},open:function(l,k){var j=this,m=$(this),h=m.parent().find(".ui-button-text").text(getLangString("jxcommon.confirm")+"("+j.timerMax+")");--j.timerMax;j.timer=window.setInterval(function(){h.text(getLangString("jxcommon.confirm")+"("+j.timerMax+")");if(j.timerMax--<=0){m.dialog("close");window.clearInterval(j.timer)}},1000)},title:f||getLangString("jxcommon.tip"),buttons:[{text:getLangString("jxcommon.confirm"),click:function(){var h=$(this).dialog("close");window.clearInterval(this.timer)}}],close:function(){a.remove();window.clearInterval(this.timer)}})}function getUrlParam(b){var a=location.search.match(new RegExp("[?&]"+b+"=([^&]+)","i"));if(a==null||a.length<1){return""}return a[1]}function getUrlParamValue(c,b){if(c==null||b==null){return""}var a=c.match(new RegExp("[?&]"+b+"=([^&]+)","i"));if(a==null||a.length<1){return""}return a[1]}function getUrlParamNameValue(e,c){if(e==null||c==null){return""}var a=e.match(new RegExp("[?&]"+c+"=([^&]+)","i"));if(a==null||a.length<1){return""}var b=a[0];if(b.length>1){if(b.charAt(0)=="?"||b.charAt(0)=="&"){b=b.substring(1)}}return b}function getContextPath(){var c=document.location.pathname;var b=c.substr(1).indexOf("/");var a=c.substr(0,b+1);return a}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")};String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")};function doClick(f,b){var c=document.getElementById(f);if(c==null){c=window.parent.document.getElementById(f)}if(c==null){return}if(document.createEvent){var a=document.createEvent("MouseEvents");a.initEvent("click",true,false);c.dispatchEvent(a)}else{if(document.createEventObject){c.fireEvent("onclick")}}}function showDate(b,c){var a=$(b).attr("tid");var f=$("#"+a);showDatePicker(b,c,"datepicker",{showButtonPanel:true,currentText:getLangString("jxcommon.datepicker.today"),closeText:getLangString("jxcommon.datepicker.close"),dateFormat:"yy-mm-dd",onClose:function(e){if(e!=""){f.attr("changed","1");if(f.attr("inputmode")!="QUERYIMMEDIATELY"){f.blur()}}resizeDialogWhenFrame(true)},beforeShow:function(e){setTimeout(function(){var g=f.datepicker("widget").find(".ui-datepicker-buttonpane");g.html("");$("<span/>",{"class":"toolbar_btn",style:"float:left;",text:getLangString("jxcommon.datepicker.today"),click:function(){var h=new Date();f.val(h.getFullYear()+"-"+JxUtil.adjustNumToFixString(h.getMonth()+1,2)+"-"+JxUtil.adjustNumToFixString(h.getDate(),2));f.datepicker("hide")}}).appendTo(g);$("<span/>",{"class":"toolbar_btn",style:"float:right;",text:getLangString("jxcommon.datepicker.clear"),click:function(){$.datepicker._clearDate(e)}}).appendTo(g)},1)}})}function showDateTime(a,b){showDatePicker(a,b,"datetimepicker",{dateFormat:"yy-mm-dd",showSecond:true})}function showTime(a,b){showDatePicker(a,b,"timepicker")}function showDatePicker(c,f,h,b){var a=$(c).attr("tid");var g=$("#"+a);b=$.extend({},{showButtonPanel:false,duration:0,onClose:function(e){if(e!=""){g.attr("changed","1");g.blur()}resizeDialogWhenFrame(true)}},b);g[h](b);g.datepicker("show").unbind("focus").bind("focus",function(){$(this).datepicker("show");resizeDialogWhenFrame()});resizeDialogWhenFrame()}function addTo(f,g,a,b){var c="app.action?app="+a;if(b!=null&&b!=""){c=c+"&type="+b}window.location.href=c}function addToMe(a,b){addTo(a,b,jx_appName,null)}function addMe(a,b){dwr.engine.setAsync(false);WebClientBean.checkDataChange(jx_appNameType,{callback:function(c){if(c){alert(getLangString("jxcommon.unsave"));dwr.engine.setAsync(true);return}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});WebClientBean.add(jx_appNameType,{callback:function(c){if(!c){alert(getLangString("jxcommon.addFail"));dwr.engine.setAsync(true);return}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});WebClientBean.getData(function(h){var g=document.getElementsByTagName("input");for(var f=0;f<g.length&&g[f];f++){if(g[f].type=="text"){var c=g[f].attributes.dataattribute;if(c){var e=h[c.nodeValue];if(e){g[f].value=e}else{}}}}});dwr.engine.setAsync(true)}function checkFieldValid(f){var b=$(f);if(b.is("select:hidden")){var e=b.parent();if(e.css("position")!="position"||e.css("position")!="fixed"){e.css("position","relative").addClass("form_td_select_simulate_hidden")}}var c=$(this).attr("format");if(c&&c.length>0&&b.val()!=""){b.val(accounting.unformat(b.val()))}var a=!b.validationEngine("validate",{focusFirstField:true,maxErrorsPerField:1,showOneMessage:true});e&&e.removeClass("form_td_select_simulate_hidden");if(!a){$("html,body").animate({scrollTop:$(".formError").offset().top-55},100)}return a}function checkPassValidation(f,g){var b=$(f).closest("form");var c=true;var a=$("*[class *= 'validate[']",b);a.each(function(){if($(this).is("select:hidden")){var h=$(this).parent();if(h.css("position")!="position"||h.css("position")!="fixed"){h.css("position","relative").addClass("form_td_select_simulate_hidden")}}var e=$(this).attr("format");if(e&&e.length>0&&$(this).val()!=""){$(this).val(accounting.unformat($(this).val()))}c=!$(this).validationEngine("validate",{focusFirstField:true,maxErrorsPerField:1,showOneMessage:true});h&&h.removeClass("form_td_select_simulate_hidden");return c});if(!c){$("html,body").animate({scrollTop:$(".formError").offset().top-55},100)}return c}function duplicate(a,b){WebClientBean.duplicate(jx_appNameType,{callback:function(c){if(c!=null){showJboDetail(c)}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function beforeSave(a,b){debug("beforeSave...");return true}function save(me,e){if($(me).attr("disabled")=="disabled"){return}$(me).attr("disabled","disabled");if(!beforeSave(me,e)){$(me).removeAttr("disabled");return}var passValidation=checkPassValidation(me,e);if(passValidation){submitData();WebClientBean.save(jx_appNameType,{callback:function(jbos){var aSave=$(me).attr("afterSave");if(aSave!=null&&aSave!=""){var afterSaveFun=eval(aSave);new afterSaveFun(me,e);if($(me).attr("afterSaveContinue")!="Y"){$(me).removeAttr("disabled");return}}var flag=getUrlParam("flag");var myurl=window.location.href;if(myurl.indexOf(".action")>0&&myurl.indexOf("/app.action")<0){if("add"==flag){myurl=myurl.replace("flag=add","uid="+eval(jbos.jbo.uidValue))}}else{myurl="app.action?app="+jx_appName;if("add"==flag){myurl=myurl+"&uid="+eval(jbos.jbo.uidValue)}else{myurl=myurl+"&uid="+getUrlParam("uid")}}dwr.engine.setAsync(false);WebClientBean.saveMessage(jx_appNameType,getLangString("jxcommon.saveSuccess"),{callback:function(){saveCallback(me,e,myurl)},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true);$(me).removeAttr("disabled")},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}$(me).removeAttr("disabled")}function saveCallback(b,c,a){if($(b).attr("refresh")!="false"){window.location.href=encodeURI(a)}else{showToolbarMsg(getLangString("jxcommon.saveSuccess"))}}function previous(a,b){dwr.engine.setAsync(false);WebClientBean.previous(jx_appNameType,function(c){if(""!=c){showJboDetail(c)}else{alert(getLangString("jxcommon.notprevious"))}});dwr.engine.setAsync(true)}function next(a,b){dwr.engine.setAsync(false);WebClientBean.next(jx_appNameType,function(c){if(""!=c){showJboDetail(c)}else{alert(getLangString("jxcommon.notnext"))}});dwr.engine.setAsync(true)}function showJboDetail(c){var b=window.location.href;var a=b.indexOf("?uid=");if(a<0){a=b.indexOf("&uid=")}if(a>0){var h=b.substring(0,a+1);var e=b.substring(a,b.length);var g=e.indexOf("&");var f="";if(g>0){f=e.substring(g,e.length)}window.location.href=h+"uid="+c+f}}function delListNoConfirm(a,c){var g="";var b=$(a).attr("fragmentid");var f="ck_"+b;$('input[name="'+f+'"]:checked').each(function(){g+=$(this).val()+","});if(g.length==0){alert(getLangString("jxcommon.chooseRecordToDel"));return}WebClientBean.delList($("#"+b).attr("jboname"),g,{callback:function(e){getTableData("div_"+b,c);if(!e){alert(getLangString("jxcommon.delFail"))}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function del(me,e){var confirmsg=$('<div id="delConfirm"></div>');confirmsg.attr("title",getLangString("jxcommon.delConfirmTitle"));confirmsg.html(getLangString("jxcommon.delConfirmMsg"));$(confirmsg).dialog({resizable:false,height:180,modal:true,buttons:[{text:getLangString("jxcommon.confirm"),click:function(){var jboname=$("#jboname").val();var uid=$("#uid").val();WebClientBean.delList(jboname,uid,{callback:function(data){if(!data){alert(getLangString("jxcommon.delFail"))}var aDel=$(me).attr("afterDel");if(aDel!=null&&aDel!=""){var afterDelFun=eval(aDel);new afterDelFun(me,e);if($(me).attr("afterDelContinue")!="Y"){return}}$("span[mxevent='gotoapp']").click()},errorHandler:errorHandler,exceptionHandler:exceptionHandler});$(this).dialog("close")}},{text:getLangString("jxcommon.cancle"),click:function(){$(this).dialog("close")}}]})}function dellist(f,g){var j="";var a=$(f).attr("fragmentid").split(",");for(var c=a.length-1;c>=0;c--){if($("#"+a[c]).length==0){a.splice(c,1);continue}var h="ck_"+a[c];$('input[name="'+h+'"]:checked').each(function(){j+=$(this).val()+","})}if(j.length==0){alert(getLangString("jxcommon.chooseRecordToDel"));return}var b=$('<div id="delConfirm"></div>');b.attr("title",getLangString("jxcommon.delConfirmTitle"));b.html(getLangString("jxcommon.delConfirmMsg"));$(b).dialog({resizable:false,height:180,modal:true,buttons:[{text:getLangString("jxcommon.confirm"),click:function(){var e=$("#"+a[0]).attr("jboname");WebClientBean.delList(e,j,{callback:function(k){if(a.length==1){getTableData("div_"+a[0],g)}else{window.location.reload()}if(!k){alert(getLangString("jxcommon.delFail"))}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});$(this).dialog("close")}},{text:getLangString("jxcommon.cancle"),click:function(){$(this).dialog("close")}}]})}function delOwer(b,f){var h="";var c=$(b).attr("fragmentid");var g="ck_"+c;$('input[name="'+g+'"]:checked').each(function(){h+=$(this).val()+","});if(h.length==0){alert(getLangString("jxcommon.chooseRecordToDel"));return}dwr.engine.setAsync(false);var a=$("#"+c).attr("jboname");WebClientBean.checkJboOwer(a,h,{callback:function(e){if(e){delList(b,f)}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}function search(a,f){if(a){var c=a.attributes.fragmentid.nodeValue;if(c){var b="list-search";if(a.attributes.apptype){b=a.attributes.apptype.nodeValue}c="div_"+c;node=document.getElementById(c);if(node){var g="app.action";if(undefined!=$(a).attr("url")){g=$(a).attr("url")}appDialog(jx_appName,b,c,g)}}}}function searchOk(a,b){getTableData($("#fromid").val(),b,appDialogClose)}function searchAll(c,f){var b=[function(){searchClear(c,f);a()},function(){searchOk(c,f);a()}];var a=function(){$(document).dequeue("mySearch")};$(document).queue("mySearch",b);a()}function searchClear(k,h){$("input:text").val("");var l=$("select");var g=l.length;for(var a=0;a<g;a++){var m=l.get(a);var f=$("option[value='']",m);if(f&&f.length>0){f.attr("selected",true)}else{var b=getLangString("jxcommon.selectoption");$(l.get(a)).append("<option selected value=''>"+b+"</option>")}$(m).trigger("change")}var c=$("input[type='checkbox']");$.each(c,function(e,j){$(j).removeAttr("checked")});WebClientBean.searchClear(jx_appNameType,"",{callback:function(){},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function inputOnChange(h,j){if(h==null){return}var k=$(h);k.attr("changed","1");var f=$("#len"+h.id);if(f.length>0){var c=$(f).attr("maxvalue");if(c!=null){if(c-JxUtil.getByteLen(h.value)<0){h.value=JxUtil.getByteVal(h.value,c);$(f).val(0)}else{$(f).val(c-JxUtil.getByteLen(h.value))}}}else{var b=k.attr("class");if(b&&b.indexOf("custom[date")<0){var g=k.attr("length");if(g){if(g-JxUtil.getByteLen(h.value)<0){h.value=JxUtil.getByteVal(h.value,g)}}}}setExpandSourceRowText(k,k.val());var a=k.attr("inputmode");if(a=="QUERYIMMEDIATELY"||a=="QUERY"){j=$.event.fix(j||window.event);if(j.keyCode==13||k.is(".hasDatepicker")){inputQueryOnBlur(h,j)}}}function checkOnChange(f,h){if(f==null){return}$(f).attr("changed","1");var j=$(f).attr("checked")=="checked"?1:0;if($(f).attr("inputmode")=="QUERY"){dwr.engine.setAsync(false);if(f==null){return}if(f.readOnly){return}if($(f).attr("changed")=="0"){return}else{$(f).attr("changed","0")}var g=$(f).attr("dataattribute");if(g==undefined||g==""){return}g+=$(f).attr("cause");WebClientBean.inputQueryOnBlur(jx_appNameType,"",g,j,{callback:function(){if($(f).attr("inputmode")=="QUERYIMMEDIATELY"){getTableData("div_"+$(f).attr("fragmentid"),h)}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}else{var c=$(f).attr("chk");var b=$(f).attr("notchk");var a=$(f).val();if(a==c){$(f).val(b)}else{$(f).val(c)}}}function inputOnFocus(a,c){if(a==null){return}if(a.readOnly&&$(a).attr("datatype")&&"date"!=$(a).attr("datatype")){return}var b=$(a).attr("format");if(b&&b.length>0&&$(a).val()!=""){var f=accounting.unformat($(a).val());$(a).val(f)}}function inputOnBlur(h,g){if(h==null){return}if(h.readOnly&&$(h).attr("datatype")&&"date"!=$(h).attr("datatype")){return}var b=$(h).attr("changed");if(b=="0"||b==null||b==""){return}var a=$(h).attr("dataattribute");if(a==undefined||a==""){return}if(!$(h).validationEngine("validate")){var j=$(h).val();var k=$(h).attr("format");if(k&&k.length>0&&j!=""){var c=accounting.formatMoney(j);$(h).val(c)}$(h).attr("changed","0");var l="#"+h.id+"_DESC";if($(l).length==0){try{l=$(l,parent.document)}catch(g){}}var f=$(h).closest("form").attr("relationship");f=(f==undefined?"":f);WebClientBean.inputOnBlur2(jx_appNameType,$(h).attr("dataattribute"),j,$(l).attr("dataattribute"),f,{callback:function(e){if(null!=e){setData($(h).closest("table[class='table_edit']"),e,"")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}}function tableInputOnBlur(k,h){if(k==null){return}if(k.readOnly&&$(k).attr("datatype")&&"date"!=$(k).attr("datatype")){return}var c=$(k).attr("changed");if(c=="0"||c==null||c==""){return}$(k).attr("changed","0");var l=$(k).attr("dataattribute");var j=k.id.substring(0,k.id.length-l.length-1);var b=j.substring(0,j.lastIndexOf("_"));j="tr_"+j;var a=$("#"+b).attr("jboname");var g=$("#"+b).attr("relationship");var f=$("#"+j).attr("uid");var m=$(k).val();if((k.tagName=="input"||k.tagName=="INPUT")&&$(k).attr("type")=="checkbox"){m=$(k).attr("checked")=="checked"?1:0}WebClientBean.tableInputOnBlur(jx_appNameType,l,m,a,g,f,{callback:function(e){if(null!=e){setData($(k).closest("tr"),e,"TABLE")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function inputQueryOnBlur(c,g){if(c==null){return}if(c.readOnly){return}var a=$(c);var h=$.trim(a.val());dwr.engine.setAsync(false);if((a.attr("changed")=="0")&&!a.is("select")){return}else{a.attr("changed","0")}var b=a.attr("dataattribute");if(b==undefined||b==""){return}var f=a.attr("cause");if(f){if(b.indexOf(".")!=-1){WebClientBean.getRelationShipCause(jx_appNameType,b,f,{callback:function(e){f=e},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}else{f=b+f}}else{return}WebClientBean.inputQueryOnBlur(jx_appNameType,"",f,h,{callback:function(){if(a.attr("inputmode")=="QUERYIMMEDIATELY"){getTableData("div_"+a.attr("fragmentid"),g)}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}function labelsQuery(c,f){if(c==null){return}var g=$(c).closest("form").attr("relationship");g=(g==undefined?"":g);var a=$(c).parent();while(a!=null){if($(a).attr("fragment")!=null){break}a=a.parent()}var b=$(c).attr("dataattribute");if(b==undefined||b==""){return}WebClientBean.inputQueryOnBlur(jx_appNameType,g,$(c).attr("dataattribute")+$(c).attr("cause"),$(c)[0].innerText,{callback:function(){getTableData($(a)[0].id,f,null,null,2)},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function selectChange(k,j){var g=$(k);if(g.attr("inputmode")=="DISPLAY"){return}if(g.is("select:hidden")){var h=g.parent();if(h.css("position")!="position"||h.css("position")!="fixed"){h.css("position","relative").addClass("form_td_select_simulate_hidden")}}var b=g.validationEngine("validate");h&&h.removeClass("form_td_select_simulate_hidden");if(b){return false}setExpandSourceRowText(g,g.find("option:selected").text());var c=$(k).attr("dataattribute");if(c==undefined||c==""){return}var l=g.attr("inputmode");if(l=="DISPLAY"){return}else{if(l=="QUERYIMMEDIATELY"||l=="QUERY"){dwr.engine.setAsync(false);var f=g.attr("workflowid");var a=g.attr("tableid");if(f!=null&&a!=null&&f!=""&&a!=""){workflowQueryOnBlur(k)}else{inputQueryOnBlur(k,j)}doPartialTriggers(k,j);dwr.engine.setAsync(true)}else{dwr.engine.setAsync(false);WebClientBean.inputOnBlur(jx_appNameType,$(k).attr("dataattribute"),k.value,{callback:function(e){if(e){var m=($(k).attr("refresh")||"").toLowerCase();if(null!=e&&m!="false"){setData(g.closest("table[class='table_edit']"),e,"")}}else{alert(getLangString("jxcommon.submitdataerror")+"JS-selectChange-inputOnBlur")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});doPartialTriggers(k,j);dwr.engine.setAsync(true)}}}function tableSelectChange(j,g){var l=$(j).parent().closest("table");var h=$(j).parent().closest("tr");var f=h.attr("uid");var a=l.attr("jboname");var c=l.attr("relationship");var k=$(j).attr("dataattribute");if(k==undefined||k==""){return}var b=new Array();$("option:selected",$(j)).each(function(){b.push($(this).val())});dwr.engine.setAsync(false);WebClientBean.tableInputOnBlur(jx_appNameType,k,b.toString(),a,c,f,{callback:function(e){if(null!=e){setData(h,e,"TABLE")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});doPartialTriggers(j,g);dwr.engine.setAsync(true)}function doPartialTriggers(me,e,dv,dn){var partialTriggers=$(me).attr("partialTriggers");if(partialTriggers){var trigs=partialTriggers.split(",");var i;for(i=0;i<trigs.length;i++){var trigTarget=$("#"+trigs[i]);if(trigTarget.length==0){trigTarget=$("[dataattribute='"+trigs[i].toUpperCase()+"']",$(me).closest("tr"))}var tagName="";if(trigTarget.length>0){tagName=trigTarget[0].tagName}if("select"==tagName||"SELECT"==tagName){var partialCause=trigTarget.attr("partialCause");if(partialCause!=null){if($(me).find("option:selected").val()==""){partialCause=""}else{partialCause=partialCause.replace(/\?/g,$(me).find("option:selected").val())}var attrs=new Array();attrs[0]=trigTarget.attr("displayvalue");attrs[1]=trigTarget.attr("displayname");var dv=attrs[0].toLowerCase();var dn=attrs[1].toLowerCase();dwr.engine.setAsync(false);WebClientBean.getJsonData(trigTarget.attr("jboname"),trigTarget.attr("relationship")||"",(trigTarget.attr("wherecause")||"")+partialCause,trigTarget.attr("orderby"),attrs,{callback:function(data){trigTarget.empty();var opts=trigTarget.attr("options");if(opts!=null&&opts.length>0){var optslist=opts.split(",");for(var m=0;m<optslist.length;m++){var ov=optslist[m].split(":");var ov1=optslist[m];var ov2=optslist[m];if(ov.length>=2){ov1=ov[0];ov2=ov[1]}var no="<option value='"+ov1+"'>"+ov2+"</option>";trigTarget.append(no)}}var options=eval("({items: ["+data+"]})");for(var j=0;j<options.items.length;j++){var newOpts="<option value='"+options.items[j][dv]+"'>"+options.items[j][dn]+"</option>";trigTarget.append(newOpts)}trigTarget.val(null).trigger("change")},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true);inputQueryOnBlur(trigTarget,e);doPartialTriggers(trigTarget,e)}}else{if("form"==tagName||"FORM"==tagName){var clause=$(me).attr("partialCause");var value=$(me).val();WebClientBean.getJboByCause($("#jboname").val(),clause,value,{callback:function(jbo){if(null!=jbo){var tableEdit=$(".table_edit",trigTarget);setData(tableEdit,jbo,"")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}}}}}function getTableData(g,v,h,p,k){if(g==null||g==""||g=="div_"){h();return}var l=false;var u=$("#"+g);if(u==null||u.length==0){u=$("#"+g,parent.document);l=true}if(u==null||u.length==0){l=false;u=$("#div_"+g)}if(u==null||u.length==0){u=$("#div_"+g,parent.document);l=true}if(u){if((u.attr("id"))==undefined){if(null!=h){h()}return}var m=(u.attr("id")).substring(4);var r=u.attr("url");var j=u.attr("type");var o=null;var s=null;var f=null;var c=null;var q=null;var t=null;var w=null;var n=null;var a=null;if(l&&parent!=null){o=parent.jx_appName;s=parent.jx_appType;f=$("#"+m+"_pagenum",parent.document);c=$("#"+m+"_topage",parent.document);q=$("#"+m+"_pagecount",parent.document);t=$("#"+m+"_pagesort",parent.document);w=$("#"+m+"_pagesize",parent.document);n=$("#"+m,parent.document).attr("jboname");a=$("#"+m,parent.document).attr("relationship")}else{o=jx_appName;s=jx_appType;f=$("#"+m+"_pagenum");c=$("#"+m+"_topage");q=$("#"+m+"_pagecount");t=$("#"+m+"_pagesort");w=$("#"+m+"_pagesize");n=$("#"+m).attr("jboname");a=$("#"+m).attr("relationship")}var x=1;if(c.length>0){x=c.val();if(!isInteger(x)||(x-q.val())>0||x<0){x=q.val()}}if(f.length>0){f.val(x)}if(r==null||r==""){r="app.action"}if(p==null||p==""){var b=null;if(l&&parent!=null){thead=b=$("th",$("#"+m+" thead:first",parent.document))}else{b=$("th:last",$("#"+m+" thead:first"))}if(b.length>2){p="";$.each(b,function(){var e=$(this).attr("dataattribute");if(e!=undefined){if(e.length>0){p=p+e+","}}})}}else{if(p=="init"){p=""}}loadingMask(u,u.find("tr").length);u.load(r,{app:o,type:j,apptype:s,pagenum:x==-1?1:x,pagesize:w.val()==-1?20:w.val(),orderby:t.val(),custColumns:p,jboname:n,relationship:a,url:r,loadType:k},function(z,y,A){loadingUnmask(u);if(y=="error"){u.html("<div class='text-center' style='color:#f30;padding:20px 0;'>loading error</div>")}else{var e=$("tbody",u);$("tr[tobeadd='true']",u).each(function(){$(this).find("select").removeAttr("disabled");e.prepend(this)});$("tr[toBeDel='true']",u).each(function(){delrow($(this).find("[mxevent='delrow']"))});bindTableEvent(m);if(h!=null){h()}if(o=="attachment"){resetIframeHeight(g)}}})}}function afterFragmentLoad(a){}function gotoapp(g,j){var c=$(g).attr("appName");var b=$(g).attr("appType");var f=$(g).attr("url");if(f==null){f="app.action?app="+c+"&type="+b+"&fromUid="+$("#uid").val()}else{if($(g).attr("localparams")=="Y"){f=f+location.search}}var a=$(g).attr("paramid");if(a!=null&&a!=""){f=f+$("#"+a).val()}if($(g).attr("context")!=null){f=contextPath+f}var h=$(g).attr("target");dwr.engine.setAsync(false);WebClientBean.checkDataChange(jx_appNameType,function(k){if(k){var e=$('<div id="delConfirm"></div>');e.attr("title",getLangString("jxcommon.dataChangeConfirmTitle"));e.html(getLangString("jxcommon.dataChangeConfirmMsg"));$(e).dialog({resizable:false,width:320,height:200,modal:true,buttons:[{text:getLangString("jxcommon.confirm"),click:function(){$(this).dialog("close");WebClientBean.rollback(jx_appNameType,{callback:function(l){if(h==null){location.href=f}else{windowopen(f,h)}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}},{text:getLangString("jxcommon.cancle"),click:function(){$(this).dialog("close")}}]})}else{if(h==null){location.href=f}else{windowopen(f,h)}}});dwr.engine.setAsync(true)}function appDialog(l,a,k,u,p,v,t,C){var y=$("<div id='dialogCenterPoint' class='dialog_center_point'></div>");$(document.body).append(y);var j="";if(u==null||u==""){u="app.action";j=u+"?app="+l+"&type="+a+"&fromid="+k}else{if(""==l&&""==a){j=u+"?fromid="+k}else{if(u.indexOf("?")<0){j=u+"?app="+l+"&type="+a+"&fromid="+k}else{j=u+"&app="+l+"&type="+a+"&fromid="+k}}}if(j.indexOf("?")>0&&j.indexOf("=")>0&&j.indexOf("&")>0){var B="";var z=j.split("?");var q=z[0];var c=z[1].split("&");for(var n=0;n<c.length;n++){var o=c[n].split("=");var e=o[0];var m=o[1];if(n==0){e="fromUid"==e?e:e.toLowerCase();B="?"+e+"="+m}else{e="fromUid"==e?e:e.toLowerCase();B=B+"&"+e+"="+m}}j=q+B}var s=100,r=150;$(".dialog").remove();var A=$("<div class='dialog'></div>");A.attr("id",k+"div");var b=$("<div class='dialog_waitting'></div>");var g=$("<iframe frameBorder='0' style='overflow:visible' width='100%' onload='appdialogIframeLoaded(this)' height='100%'></iframe>");A.append(b).append(g);g.attr("id",k+"frame").attr("src",j);fixIEProcessBar();if(p>0){s=p}if(v>0){r=v}if(isMobile()){s="98%"}g.attr("pwidth",s);g.attr("pheight",r);var f={autoOpen:false,modal:true,height:r,width:s,title:C?C:"",resizable:true,draggable:true,beforeClose:t==null?dialogBeforeClose:t,close:dialogClose,resize:function(h,w){if(isMobile()){g.attr("width","96%")}else{g.attr("width",w.size.width-30)}}};A.dialog(f);A.dialog("open");A.dialog("option","position",{my:"center",at:"center",of:y});A.prev().find("button").blur()}function fixIEProcessBar(){if(/msie/.test(navigator.userAgent.toLowerCase())){var a=$("<iframe style='display:none'/>").appendTo(top.document.body);a[0].contentDocument.write("");a[0].contentWindow.close()}}function appdialogIframeLoaded(j,g){var h=j.id;var l=h.substring(0,h.length-5);var b=$("#"+l+"div");var e=j.contentDocument.body;var a=e.scrollWidth;var k=e.scrollHeight+60;var c=+$(j).attr("pwidth");var f=+$(j).attr("pheight");k=f==150?k:f;a=c>a?c:a;j.setAttribute("width",a+10);a=a+30;b.dialog({width:a,height:k});j.contentWindow.initWidth=a;j.contentWindow.initHeight=k;$(j).show();$(".dialog_waitting",$(j).parent()).hide();j.contentWindow.$currentDialog=b}function dialogBeforeClose(a,b){}function dialogClose(b,c){$("#dialogCenterPoint").remove();var e=b.target;var a=e.id;if(a.length>0){a=a.substring(4);a=a.substring(0,a.length-3);if($("#"+a).length>0&&$("#"+a)[0].tagName=="TABLE"){loadDataTable(a)}}}function appDialogClose(c,g){try{var j="#fromid";if($(j).length==0){j=$(j,parent.document)}var h=$(j).val();if(h&&undefined!=h){var a=window.parent.$("#"+h+"div");a.dialog("close")}else{if(JxUtil.isTopWindow()){window.opener=null;window.close()}else{var f=window.parent.$(".dialog");if(f.length){f.dialog("close")}}}}catch(b){debug("appDialogClose : "+b)}}function lookupAction(e,b,a,c){a=a||0;c=c||0;if(e.toLowerCase().indexOf(".action")>0){appDialog(jx_appName,jx_appType,b,e,a,c)}else{if(e.indexOf("?")>0){var f=e.split("?");if(f.length>1){appDialog(f[0],"lookup_list&"+f[1],b,null,a,c)}}else{appDialog(e,"lookup_list",b,null,a,c)}}}function lookup(w,t){var x=$(w).attr("tag");if(x&&x=="tablebutton"){var s=$(w).closest("table");var z=s.closest(".dataTables_scrollHead");var y=$("input[type='checkbox'][name='allbox']",s);if(z.length){s=z.next().find("table")}if(y&&y.length>0){var n=$("input[type='checkbox'][name!='allbox']:checked",s);if(n&&n.length>0){var c="";$.each(n,function(e,A){c+=$(A).val();if(e<n.length-1){c+=","}});var m=$("#fromid").val();var b=$("#"+m,parent.document);if(b&&b.length>0){var u=b.closest("table");var f=u.attr("jboname");var a=u.attr("relationship");dwr.engine.setAsync(false);WebClientBean.lookup(jx_appNameType,s.attr("jboname"),s.attr("relationship"),c,parent.jx_appNameType,f,a,{callback:function(A){if("success"==A){var C="#fromid";if($(C).length==0){C=$(C,parent.document)}var B=$(C).val();var e=window.parent.$("#"+B+"div");e.dialog("close");parent.window.getTableData("div_"+u.attr("id"),null,null,null,1);e.remove()}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}}else{alert(getLangString("jxcommon.notchoose"))}}else{debug("非多选的窗口，你干嘛非要用这种实现？ 请用默认实现方式!");return}}else{var k=$(w).attr("tid");var v=$(w).closest("tr");var o="#fromid";if($(o).length==0){o=$(o,parent.document)}var l=$(o).val();var h=$(o).val();var p=window.parent.$("#"+h+"div");p.dialog("close");var j="#"+h;if($(j).length==0){j=$(j,parent.document)}$(j).val(k);$(j).attr("changed","1");var r=$("#"+h+"_DESC");if(r.length==0){r=$("#"+h+"_DESC",parent.document)}if(r.length!=0){var l=r.attr("dataattribute");if(l.indexOf(".")>0){l=l.split(".")[1]}var g="";$("td",v).each(function(e,A){if($(this).attr("dataattribute")==l){g=$(this).attr("title");return}});r.val(g)}var q=r.closest("form").find(".formErrorContent");if(undefined!=q){q.parent().remove()}$(j).focus();$(j).blur();p.remove()}}function lookupClear(b,c){var a=$(b).siblings("input");$.each(a,function(e,f){$(f).focus();$(f).val("");$(f).attr("changed",1);$(f).blur()});$(b).focus()}function report(b,c){var a=$(b).attr("appname");var f=$(b).attr("target");if(f!=null&&f.length>0){$("form:first").attr("target",f)}$("form:first").attr("action",reportUrl+a).submit()}function selectAppInboxStatus(b,f){dwr.engine.setAsync(false);var a=$(b).val();var c=$(b).attr("fragmentid");if(a=="1"||a=="2"){$("#n_"+b.id).css("display","");$("#l_"+b.id).css("display","")}else{$("#n_"+b.id).css("display","none");$("#l_"+b.id).css("display","none")}if(a=="1"){$("#r_n_"+b.id).css("display","")}else{$("#r_n_"+b.id).css("display","none")}WebClientBean.selectAppInboxStatus(jx_appNameType,a,$(b).attr("statusColumn"),$(b).attr("creatorColumn"),$(b).attr("transactorColumn"),$(b).attr("backflagColumn"),{callback:function(e){getTableData($(b).attr("fragmentId"))},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}function selectAppInboxNode(b,c){dwr.engine.setAsync(false);var a=$(b).val();WebClientBean.selectAppInboxNode(jx_appNameType,a,{callback:function(){},errorHandler:errorHandler,exceptionHandler:exceptionHandler});getTableData($(b).attr("fragmentId"));dwr.engine.setAsync(true)}function showWorkflowInfo(b,c,a){}function routeDialog(l,h){var a=[];var b=$(l).attr("fragmentid");var k=l.id.substr(2);var g="ck_"+b;$('input[name="'+g+'"]:checked').each(function(){a.push($(this).val())});if(a.length==0){alert(getLangString("jxcommon.chooseRecordToRoute"));return}var c=$("#"+b).attr("jboname");var j="1";if($("#"+k).val()==$("#"+k).attr("firstActTaskId")){j="0"}var f=$("#status").val();var m=$("#nextStatus").val();dwr.engine.setAsync(false);WebClientBean.getAppWorkflowParam(jx_appNameType,{callback:function(e){if(e){var n="app.action?fromUid="+a+"&fromApp="+jx_appName+"&fromAppType="+jx_appType+"&fromJboname="+c+"&backflag="+j;appDialog("workflow","workflow",b,n,"auto","300px")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}function beforeRouteme(a,b){return true}function routeme(me,e){if(!beforeRouteme(me,e)){return}var passValidation=checkPassValidation(me,e);if(passValidation){passValidation=false;dwr.engine.setAsync(false);submitData();WebClientBean.save(jx_appNameType,{callback:function(jbos){var aSave=$(me).attr("afterSave");if(aSave!=null&&aSave!=""){var afterSaveFun=eval(aSave);new afterSaveFun(me,e);if($(me).attr("afterSaveContinue")!="Y"){return}}if(jbos!=null){passValidation=true}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}else{return}if(!passValidation){return}var uid=$("#uid").val();if(uid==null||uid==""||uid=="undefined"){alert(getLangString("jxcommon.route.error1"));return}var jboname=$("#jboname").val();if(jboname==null||jboname==""||jboname=="undefined"){alert(getLangString("jxcommon.route.error2"))}var status=$("#status").val();var nextStatus=$("#nextStatus").val();var instanceid=$("#instanceid").val();var bpmInstanceId="";var idx=instanceid.indexOf("#");if(idx>0){bpmInstanceId=instanceid.substring(0,idx)}else{bpmInstanceId=instanceid}if(bpmInstanceId!=""&&bpmInstanceId.length>2&&bpmInstanceId.indexOf("JXBPM.")>=0){var myurl=contextPath+"/jxbpm/route.action?fromUid="+uid+"&fromApp="+jx_appName+"&fromAppType="+jx_appType+"&fromJboname="+jboname+"&instanceid="+bpmInstanceId;var fromId=me.id;if(fromId==undefined||fromId==""){fromId="workflow"}appDialog(jx_appName,jx_appType,fromId,myurl,650,150,null,getLangString("jxcommon.routeme.title"))}else{dwr.engine.setAsync(false);WebClientBean.getAppWorkflowParam(jx_appNameType,{callback:function(data){if(data!=""){var myurl=contextPath+"/app.action?fromUid="+uid+"&fromApp="+jx_appName+"&fromAppType="+jx_appType+"&fromJboname="+jboname+"&instanceid="+bpmInstanceId;var fromId=me.id;if(fromId==undefined||fromId==""){fromId="workflow"}appDialog("workflow","workflow?engine="+data,fromId,myurl,650,150,null,getLangString("jxcommon.routeme.title"))}else{alert(getLangString("jxcommon.loadbpmconfigerror"))}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}}function routeCommon(s,o){if($(s).attr("disabled")=="disabled"){return}var l=$('input[name="action"]:checked');var k=l.val();var g=l.attr("id");var b=$("label[for='"+g+"']").text();if(k==undefined){alert(getLangString("jxcommon.bpm.needaction"));return}var f=$("select",$("div[useraction]:visible"));var t=new Array();if(f.length){$("option:selected",f).each(function(){t.push($(this).val())});if(!t.length){alert(getLangString("jxcommon.bpm.needuser"));return}}var q=$("#noteRequired").css("display");var r=$("#note").val();if(q!=undefined&&q!="none"){if(r==""){alert(getLangString("jxcommon.bpm.neednote"));return}}if(r==undefined){r=""}$(s).attr("disabled","disabled");r=b+";"+r;dwr.engine.setAsync(false);var p=$("#fromApp").val();var h=$("#fromAppType").val();var a=$("#fromJboname").val();var n=$("#fromUid").val();var c="";var m="";$("input[name='tousers']:checked").each(function(){c+=$(this).val()+","});c+=t;WebClientBean.routeCommon(p+"."+h,a,n,k,r,c,m,{callback:function(e){alert(e);WebClientBean.reloadCurrentJboData({callback:function(){var u=parent.location.href;if(u.indexOf("flag=add")>-1){u=u.replace(/flag=add/,"uid="+n)}window.parent.location.href=u},errorHandler:errorHandler,exceptionHandler:exceptionHandler})},errorHandler:errorHandler,exceptionHandler:exceptionHandler});var j=$("#fromid").val();if(j==null||j==""){appDialogClose(s,o)}else{getTableData("div_"+$("#fromid").val(),o,appDialogClose)}dwr.engine.setAsync(true)}function route(m,j,n,o){if(n==undefined&&o==undefined){routeme(m,j);return}var k=$("#noteRequired").css("display");if(k!="none"){if($("#note").val()==""){alert(getLangString("jxcommon.bpm.neednote"));return}}dwr.engine.setAsync(false);var l=$("#fromApp").val();var a=$("#fromJboname").val();var h=$("#fromUid").val();var b="";var g="";$("input[name='tousers']:checked").each(function(){b+=$(this).val()+","});g+="[";var c=$("form[id^='wftParamForm_']");$.each(c,function(e,t){var s="{";var r=$("#wftParamKey",t).val();s=s+"'key':'"+r+"',";var q=$("#jboname",t).val();s=s+"'jboname':'"+q+"'";s=s+",'attr':[";var p=$(".table_edit tr",t);$.each(p,function(u,x){s+="{";var v=$(".form_td_content input",x).attr("dataattribute");var w=$(".form_td_content input",x).val();s=s+"'attribute':'"+v+"',";s=s+"'value':'"+w+"'";s+="}";if(u<p.length-1){s=s+","}});s=s+"]";s+="}";g=g+s;if(e<c.length-1){g+=","}});g+="]";WebClientBean.route(l,a,h,o,n,$("#note").val(),b,g=="[]"?"":g,{callback:function(e){alert(e);WebClientBean.reloadCurrentJboData({callback:function(){window.parent.location.reload()},errorHandler:errorHandler,exceptionHandler:exceptionHandler})},errorHandler:errorHandler,exceptionHandler:exceptionHandler});var f=$("#fromid").val();if(f==null||f==""){appDialogClose(m,j)}else{getTableData("div_"+$("#fromid").val(),j,appDialogClose)}dwr.engine.setAsync(true)}function routeOk(a,b){route(a,b,1,null)}function routeBack(a,b){route(a,b,2,null)}function routeBackLast(a,b){route(a,b,4,null)}function routeCancel(a,b){route(a,b,8,null)}function expexcel(a,b){dwr.engine.setAsync(false);WebClientBean.preExpExcel(jx_appNameType,{callback:function(f){if(f>0){var c=$('<div id="delConfirm"></div>');c.attr("title",getLangString("jxcommon.tip"));var e=getLangString("jxcommon.expexcelmsgstart")+$.trim(f)+getLangString("jxcommon.expexcelmsgend");c.html(e);$(c).dialog({resizable:false,width:320,height:200,modal:true,buttons:[{text:getLangString("jxcommon.confirm"),click:function(){$(this).dialog("close");expExcel()}},{text:getLangString("jxcommon.cancle"),click:function(){$(this).dialog("close")}}]})}else{expExcel()}},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true)}function expExcel(){var a=$("#appName",window.parent.document).text();var b=$("#appName",window.parent.document).html();if(!a){if(a.length<=0){a=b}}WebClientBean.expExcel(jx_appNameType,a,{callback:function(c){$("body",window.parent.document).unmask();dwr.engine.openInDownload(c)},async:false,errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function exportExcel(a){if(bIsIE){if((sUserAgent.indexOf("msie 6.0")>0)||(sUserAgent.indexOf("msie 7.0")>0)){exportByServer(a,"excel")}else{exportExcelForIE(a)}}else{exportByServer(a,"excel")}}function exportWord(a){if(bIsIE){if((sUserAgent.indexOf("msie 6.0")>0)||(sUserAgent.indexOf("msie 7.0")>0)){exportByServer(a,"word")}else{exportWordForIE(a)}}else{exportByServer(a,"word")}}function exportByServer(e,b){var a=$("#div_"+e).html();a=a.replace($("#foot_"+e).html(),"");var c=$("<form method='post' action='./export' style='display:none' enctype='application/x-www-form-urlencoded;charset=utf-8'><textarea name='context'>"+a+"<textarea/><input type='hidden' name='filetype' value='"+b+"'></form>");c.submit()}function exportExcelForIE(c){window.clipboardData.setData("Text",$("#div_"+c).html().replace($("#foot_"+c).html(),""));try{var a=new ActiveXObject("Excel.Application");var b=a.workbooks.add();var g=b.worksheets(1);a.DisplayAlerts=false;a.visible=true}catch(f){exportByServer(c);return false}b.worksheets(1).Paste}function exportWordForIE(tbid){var divid=eval("div_"+tbid);var oWD=new ActiveXObject("Word.Application");var oDC=oWD.Documents.Add("",0,1);var oRange=oDC.Range(0,1);var sel=document.body.createTextRange();sel.moveToElementText(divid);sel.select();sel.execCommand("Copy");oRange.Paste();oWD.Application.Visible=true}function attachment(g,h){var b=$(g).attr("uid");var f=$(g).attr("upath");var c=$(g).attr("type");var j=$(g).attr("vfolder");var a=f+"&cols="+$(g).attr("cols")+"&iw="+$(g).attr("imgwidth")+"&ih="+$(g).attr("imgheight")+"&it="+$(g).attr("imgtype");if(undefined!=j){a=a+"&vfolder="+j}if(c=="IMGLIST"){appDialog("attachment","imglist",b,a,700,150)}else{appDialog("attachment","list",b,a,700,150)}}function custcolumn(b){if(b==null||b==""){return}if((sUserAgent.indexOf("msie 6.0")>0)||(sUserAgent.indexOf("msie 7.0")>0)){alert("对不起，您的浏览器版本太低，不支持此功能。");$("#"+b).css("display","none");return}var a=$("#"+b).attr("jboname");var c=$("#"+b).attr("relationship");appDialog("customcolumn","list",b,"app.action?objectname="+a+"&relationship="+c,"auto","400px")}function tableFullScreen(a){$("#div_"+a).dialog({height:"auto",width:"100%",resizable:true,modal:true})}function delrowwithconfirm(g,j){var h=$(g).attr("id");var c=$(g).closest("tr");var k=c.attr("id");var f=$(g).closest("table");var b=f.attr("id");var a=$('<div id="delConfirm"></div>');a.attr("title",getLangString("jxcommon.delConfirmTitle"));a.html(getLangString("jxcommon.delConfirmMsg"));$(a).dialog({resizable:false,height:180,modal:true,buttons:[{text:getLangString("jxcommon.confirm"),click:function(){WebClientBean.delRow(jx_appNameType,f.attr("jboname"),f.attr("relationship"),c.attr("uid"),true,{callback:function(e){if(e){WebClientBean.save(jx_appNameType,function(){getTableData("div_"+b)})}}});$(this).dialog("close")}},{text:getLangString("jxcommon.cancle"),click:function(){$(this).dialog("close")}}]})}function delrow(g,j){var h=$(g).attr("id");var c=$(g).closest("tr");var k=c.attr("id");var f=$(g).closest("table");var b=f.attr("id");var a=$(g).attr("flag");if(f.attr("expandtype")!=undefined){if(c.attr("expand")=="1"){$("td:first span",c).click()}}dwr.engine.setAsync(false);if(a=="0"){WebClientBean.delRow(jx_appNameType,f.attr("jboname"),f.attr("relationship"),c.attr("uid"),true,{callback:function(r){if(r){if($("#"+k).attr("tobeadd")=="true"){var q=$("#"+k).prev();if(!q.length){q=$("#"+k).next()}if(q.length){$("#"+k).remove();q.trigger("click")}else{getTableData("div_"+$("#"+k).closest("table").attr("id"),null,null,null,1)}}else{var n=$("#"+k).clone();c.css("display","none");n.find("script").remove();n.attr("id",c.attr("id")+"_del");c.before(n);$("input, select, checkbox, img",n).each(function(s,v){if($(v).hasClass("lookupicon")){$(v).remove()}$(v).attr("disabled","disabled").attr("readonly","readonly").removeAttr("required");var t=$(v);var u=t.attr("class");if(undefined!=u){$.each(u.split(" "),function(w,x){if(undefined!=x&&x.indexOf("validate")>=0){t.removeClass(x)}})}});var m=$("td:first",n).html();var l=m.indexOf("<script");var e=m.indexOf("<\/script>");if(l>0&&e>0){m=m.substring(0,l)+m.substring(e+9)}var p=n[0].clientWidth-$("td:last",n)[0].clientWidth;$("td:first",n).html("<div style='position: relative;z-index:16;' class='rowDelLine'>"+m+"<div style='width:"+p+"px;position:absolute;top:50%;border-bottom:solid 1px #000'></div></div>");$("#"+h).attr("flag","1");var o=$("#"+h).attr("src").replace("delrow","undelrow");$("#"+h).attr("src",o).removeAttr("disabled").find(".select2").css({"z-index":15})}}else{alert(getLangString("jxcommon.delFail"))}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}else{WebClientBean.delRow(jx_appNameType,f.attr("jboname"),f.attr("relationship"),c.attr("uid"),false,{callback:function(e){if(e){c.next().show().trigger("click");c.remove()}else{alert(getLangString("jxcommon.undelFail"))}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}dwr.engine.setAsync(true)}function addrow(a,b){addRowAndSetValue(a,b,null)}function addRowAndSetValue(f,j,h){var b=f.id.substring(0,f.id.length-$("#"+f.id).attr("mxevent").length-1);var c=$("#"+b);if($(f).attr("enabled")=="0"){alert(getLangString("jxcommon.addFail"));return}$(f).attr("enabled","0");var a=c.attr("expandtype")==undefined?false:true;if(a){var g=$("tr[expand='1']",c);$("td:first span",g).click()}WebClientBean.addRow(jx_appNameType,c.attr("jboname"),c.attr("relationship"),h,{callback:function(e){if(e==null){alert(getLangString("jxcommon.addFail"))}else{getTableData("div_"+b,null,null,null,1);$(f).attr("enabled","1")}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function add(a,b){WebClientBean.canJboSetAdd(jx_appNameType,{callback:function(c){if(c){var e=$(a).attr("addurl");if(e==null){e="./app.action"}if(e.indexOf("?")>0){e+="&"}else{e+="?"}e+="flag=add&app="+jx_appName;window.location.href=e}else{alert(getLangString("jxcommon.addFail"))}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function renderCKEditor(b){if(b==null){return}var e=$("#"+b);if(e&&e[0]){CKEDITOR.config.language=userLangeCode;CKEDITOR.config.filebrowserImageUploadUrl=contextPath+"/ckedituploadimg.action";var a=$("#"+b)[0].tagName;if(a=="DIV"||$("#"+b).attr("readonly")=="readonly"){CKEDITOR.disableAutoInline=true;CKEDITOR.config.allowedContent=true;var f=CKEDITOR.inline(b,{readOnly:true,toolbar:[]})}else{var c=$("#"+b).attr("renderExtends");if(""==c){c="BASE"}var f=CKEDITOR.replace(b,{toolbar:c,on:{change:function(g){$("#"+b).attr("changed","1");f.updateElement();$("#"+b).blur()},blur:function(g){f.updateElement();$("#"+b).blur()},key:function(g){}}})}}}function submitData(){}function href(a,c){var f=$(a).attr("params");if(f!=null&&f!=""){var b=$(a).attr("target");if(b!=null&&b!=""){windowopen(f,b)}else{location.href=f}}}function setData(c,a,b){setFormData(c,a,b);$("table[relationship!=''][jboname!='']",c).each(function(f,m){var n=$(this).attr("relationship");var j=$("#jboname",c.closest("form")).val();j=j.toUpperCase();var h=null;if(a.children){h=a.children[j+"."+n];if(typeof(h)=="undefined"||h==null){h=a.children[j+"."+n+"."+a.uidValue]}}if(null!=h&&null!=h.jbo){var l=j+"."+n;if($(this).attr("id")!=undefined){getTableData("div_"+$(this).attr("id"),null,null,null,1)}else{try{var g=$(this).closest("td").children("div").eq(0);getTableData($(g).attr("id"),null,null,null,1)}catch(k){debug("子表"+l+"刷新失败")}}}})}function setFormData(c,a,b){$("select[dataattribute!=''],input[type='text'][dataattribute!=''],textarea[dataattribute!=''],input[type='textbox'][dataattribute!=''],label[dataattribute!=''],input[type='checkbox'][dataattribute!='']",c).each(function(p,l){if($(this).attr("class")&&$(this).attr("class").indexOf("form_label_tip")>=0){return}var n=$(this).attr("dataattribute");var j=this.tagName;var e=null;if(undefined!=n&&n.indexOf(".")>0){var f=n.split(".");var g=$("#jboname",c.closest("form")).val();if(b=="TABLE"){g=c.closest("table[jboname!='']").attr("jboname")}g=g.toUpperCase();var h=null;if(a.children){h=a.children[g+"."+f[0]];if(typeof(h)=="undefined"||h==null){h=a.children[g+"."+f[0]+"."+a.uidValue]}}if(null!=h&&null!=h.jbo){e=h.jbo.datas[f[1]]}else{e=""}}else{e=a.datas[n]}if(null!=e&&undefined!=e){if(e&&(e.toString().indexOf("GMT")>0||e.toString().indexOf("UTC")>0)){var k=$(this).attr("class");if(k&&k!=undefined){var m="";if(k.indexOf("custom['date']")>=0){m="date"}else{if(k.indexOf("custom[dateTime]")>=0){m="dateTime"}}e=JxUtil.formatDate(e.toString(),m)}}}if(undefined!=e&&null!=e&&"null"!==e){if((typeof($(this).closest("table").attr("relationship"))=="undefined")||b=="TABLE"){var o=$(this).attr("format");if(o&&o.length>0&&""!=e){e=accounting.formatMoney(e)}if(j=="LABEL"){$(this).text(e)}else{if($(this).attr("type")=="checkbox"){if("1"==e||1==e){$(this).attr("checked","checked")}else{$(this).removeAttr("checked")}$(this).val(e)}else{if(j=="SELECT"){}else{$(this).val(e)}}}}else{}}})}function dhtmlxGantt(g,h){var b=$(g).attr("columns");if("TSEP"==b){gantt.config.columns=[{name:"text",label:"任务",tree:true,width:"*"},{name:"start_date",label:"开始时间",align:"right",width:"70"},{name:"end_date",label:"结束时间",align:"right",width:"70"},{name:"progress",label:"完成进度",align:"right",width:"40"}];gantt.config.grid_width=500}else{if("TSE"==b){gantt.config.columns=[{name:"text",label:"任务",tree:true,width:"*"},{name:"start_date",label:"开始时间",align:"right",width:"70"},{name:"end_date",label:"结束时间",align:"right",width:"70"}]}else{if("TE"==b){gantt.config.columns=[{name:"text",label:"任务",tree:true,width:"*"},{name:"end_date",label:"结束时间",align:"right",width:"70"}]}else{if("NONE"==b){gantt.config.columns=[];gantt.config.grid_width=2}else{gantt.config.columns=[{name:"text",label:"任务",tree:true,width:"*"}]}}}}var f=$(g).attr("dReadonly");if("true"==f){gantt.config.readonly=true;gantt.config.drag_lightbox=false;gantt.attachEvent("onBeforeLightbox",function(e){return false})}var j=$(g).attr("scale");if(j=="year"){gantt.config.scale_unit="year";gantt.config.step=1;gantt.config.scale_height=50;gantt.config.subscales=[{unit:"year",step:1,date:"%Y"}]}else{if(j=="month"){gantt.config.scale_unit="month";gantt.config.step=1;gantt.config.scale_height=50;gantt.config.subscales=[{unit:"year",step:1,date:"%Y"}]}else{if(j=="week"){gantt.config.scale_unit="week";gantt.config.step=1;gantt.config.scale_height=80;gantt.config.subscales=[{unit:"month",step:1,date:"%M"},{unit:"year",step:1,date:"%Y"}]}else{if(j=="day"){gantt.config.scale_unit="month";gantt.config.step=1;gantt.config.scale_height=80;gantt.config.date_scale="%Y年%F";var c=function(k){var e=gantt.date.date_to_str("%d %M");var l=gantt.date.add(gantt.date.add(k,1,"week"),-1,"day");return e(k)+" - "+e(l)};gantt.config.subscales=[{unit:"week",step:1,template:c},{unit:"day",step:1,date:"%D"}]}}}}var a=$(g).attr("id");gantt.config.fit_tasks=true;gantt.config.api_date="%Y-%n-%d";gantt.config.date_grid="%Y-%n-%d";gantt.config.sort=true;var a=$(g).attr("id");gantt.init(a)}function openTreeTable(f,j){var g=$(f).closest("tr");var c=$(f).closest("table[rootparent!='']");var h=-1;if(g){h=g.attr("uid");if(!c||h<0){return}if($("td:first span",g).attr("treeStatus")=="close"){$("td:first span",g).attr("treeStatus","open");$("td:first span",g).removeClass("treeclose").addClass("treeopen")}else{closeTreeTable(g);return}}var b=c.attr("jboname");var a=c.attr("rootparent");var k=a.split(":");WebClientBean.getJboListByCause(b,k[0]+"=?",h,{callback:function(q){if(null!=q){if(q.length==0){$(f).removeClass("treeopen").addClass("treechild");$(f).removeAttr("onclick");return}for(var o=0,n=q.length;n>o;n--){var m=q[n-1];var e=g.clone();e.attr("uid",m.uidValue).attr("pid",h);$("td:first span",e).removeClass("treeopen").addClass("treeclose").attr("treeStatus","close");var p=$("td:first span",g).css("margin-left").replace("px","");$("td:first span",e).css("margin-left",parseInt(p)+20);setData(e,m,"TABLE");e.insertAfter(g)}}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function closeTreeTable(e){var c=$(e).closest("table");var b=$(e).attr("uid");var g=$("tr[pid='"+b+"']",c);var f=g.length;if(f>0){$("td:first span",e).attr("treeStatus","close");$("td:first span",e).removeClass("treeopen").addClass("treeclose");for(var a=0;a<f;a++){closeTreeTable(g[a]);$(g[a]).remove()}}else{$(e).remove()}}function selectTableTr(h,j){j=$.event.fix(j||window.event);if(!j.target.nodeName.toUpperCase().match(/^(a|input)$/i)){var f=$(h);var a=f.closest(".fragment-mode");var b=f.find("input:checkbox");if(b.length){var g=$("input[type='checkbox'][name='allbox']",a);if(g&&g.length>0){$("tr[class='trSelected']",table).removeClass("trSelected")}var c=b[0].checked;b.prop("checked",!c);ckOneSelectHandler(b[0],b.attr("index"))}f.toggleClass("trSelected")}}function excuteJboSetMethod(f,e,c,a,b,g){if(f==""||f==undefined||f==null){alert("请配置jboname");return false}if(e==""||e==undefined||e==null){alert("请配置jbo method")}WebClientBean.excuteJboSetMethod(f,e,c,{callback:function(h){if(h=="true"){if(b!=""){msgTip(b,"")}}else{if(h=="false"){if(a!=""){msgTip(a,"")}}else{msgTip(h,"")}}if(g!=null){g(h)}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function getJboSetMethodReturnValue(c,b,a){if(c==""||c==undefined||c==null){alert("请配置jboname");return false}if(b==""||b==undefined||b==null){alert("请配置jbo method")}dwr.engine.setAsync(false);var e="";WebClientBean.excuteJboSetMethod(c,b,a,{callback:function(f){e=f},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true);return e}function showDashboardLet(b){var a=$(b).attr("href");var c=$(b).attr("target");windowopen(a,c)}function windowopen(a,b){var c=document.createElement("a");c.id="gg"+parseInt(100*Math.random());c.target=b;c.href=a;document.body.appendChild(c);c.click();document.body.removeChild(c)}function getMainAppAttributeValue(a){dwr.engine.setAsync(false);var b="";WebClientBean.getData(function(c){for(var e in c){if(c.hasOwnProperty(e)){if(e==a){b=c[e]}}}});dwr.engine.setAsync(true);return b}function importFile(b,f){var g=$(b).attr("relationship");var c=$(b).attr("fragmentid");if(null==g||undefined==g){g=$("#"+c).attr("relationship")}var a="app.action?relationship="+(undefined==g?"":g)+"&appNameType="+jx_appNameType;appDialog("impfile","impfile","impfile",a,"auto",200,function(e,h){getTableData("div_"+c.toLowerCase(),f,null)})}function tabCreate(a,b){}function beforeActivate(a,b){}function beforeLoad(a,b){}function tabActivate(a,b){}function beforeTabLoad(a,b){b.panel.html("load... ");b.jqXHR.error(function(){b.panel.html("Couldn't load this tab. ")})}function tabLoaded(a,b){}var tabUtil={getTabGroup:function(a){return $("#"+a).tabs()},getSelectedTabIndex:function(a){return this.getTabGroup(a).tabs("option","active")},getSelectedTabLink:function(a){return $(".ui-tabs-active a","#"+a)},loadTab:function(e,b,a){var c=this.getSelectedTabLink(e).attr("href");this.getSelectedTabLink(e).attr("href",a);this.getTabGroup(e).data("loaded",false);this.getTabGroup(e).tabs("load",b);this.getSelectedTabLink(e).attr("href",c)},changeTab:function(f,a,e){var b=$($("a[class='ui-tabs-anchor']",$("#"+f))[a]);var c=b.attr("href");b.attr("href",e);this.getTabGroup(f).tabs("option","active",a);this.getTabGroup(f).tabs("refresh");b.attr("href",c)}};function getAttachFileSize(a,b,c){dwr.engine.setAsync(false);var e="";WebClientBean.getAttachmentFileSize(a,b,c,{callback:function(f){e=f},errorHandler:errorHandler,exceptionHandler:exceptionHandler});dwr.engine.setAsync(true);return e}function sessionTimeout(a){alert(getLangString("jxcommon.sessionTimeout"));if(window){window.top.location.href=a+"/loginAction.do"}}function inputQueryParams(b,a,c){WebClientBean.inputQueryOnBlur(jx_appNameType,"",b,a,{callback:function(){if(c!=null){c()}},errorHandler:errorHandler,exceptionHandler:exceptionHandler})}function initUILang(a){}function showToolbarMsg(b){if(b.length>0){var a=$("#appMsg");if(a.length==0){a=$("#appMsg",parent.document)}if(a&&a.length>0){a.text(b).show();setTimeout(function(){a.hide().text("")},2000)}else{alert(b)}}}function logout(){parent.window.location.href="/jxweb/login/logout.jsp"}function afterTreeInit(a){}function refresh(a,b){location.reload()}function refreshAttlist(a){var b=document.getElementById("iframeAtt_"+a).src;$("iframeAtt_"+a).attr("src",$("iframeAtt_"+a).attr("src"));document.getElementById("iframeAtt_"+a).src=b}function resetIframeHeight(b){var a=$("iframe[name^='iframeAtt_']",parent.document);$.each(a,function(c,f){var g=$(f).contents().find("div[id='"+b+"']");if(g.length>0){var e=f;if(e&&!window.opera){if(e.contentDocument&&e.contentDocument.body.offsetHeight){e.height=e.contentDocument.body.offsetHeight}else{if(e.Document&&e.document.body.scrollHeight){e.height=e.document.body.clientHeight}}}}})}function isNull(a){if(a==null){return true}if(a.length==0){return true}return false}function isBlank(b){if(b==null){return true}for(var a=0;a<b.length;a++){if((b.charAt(a)!=" ")&&(b.charAt(a)!="\t")&&(b.charAt(a)!="\n")){return false}}return true}function isDigit(b){if(b!=null||b.length==1){var a="1234567890";if(a.indexOf(b)!=-1){return true}}return false}function isInteger(b){for(var a=0;a<b.length;a++){if(!isDigit(b.charAt(a))){return false}}return true}function isNumeric(b){var c=false;for(var a=0;a<b.length;a++){if(!isDigit(b.charAt(a))){if(b.charAt(a)=="."){if(c==true){return false}else{c=true}}else{return false}if(b.charAt(a)=="-"){return false}}}return true}function initSql(f,g){$(f).attr("disabled","true");$("#result").show();$("#result").html(getLangString("jxcommon.wait"));var b=$(f).attr("url");if(b==""||b==undefined){b="config_sqlInstall.action?"+window.location.search}var c=$(f).attr("filename");if(c==null||c==undefined){c=$("#fileName").val()}var a=$(f).attr("msgid");if(a==""||a==undefined){a="result"}$.ajax({type:"GET",url:b,data:{fileName:c},dataType:"html",cache:false,success:function(e,h){$("#"+a).html(e);$("#"+a).show();prettyPrint();$(f).removeAttr("disabled")},error:function(h,k,j){$("#"+a).html(h+","+k+","+j);$("#"+a).show();prettyPrint();$(f).removeAttr("disabled")}})}$(function(){var b=getUrlParam("uid");var a=getUrlParam("flag");if(b&&b>0||b!=""){$(".appbar-menu").html("")}if(a&&a!=""){$(".appbar-menu").html("")}$(".toolbar_btn").on("mouseenter",function(){var c=$(this).find("img")[0];if(c){c.src=c.src.replace(".png","_hover.png")}}).on("mouseleave",function(){var c=$(this).find("img")[0];if(c){c.src=c.src.replace("_hover.png",".png")}})});function AmountInWords(e,w){e=e.toString().replace(/,/g,"");e=e.replace(/^0+/,"");if(e==""){return"零元整"}else{if(isNaN(e)){return"错误：金额不是合法的数值！"}}var c="";var r="";if(e.length>1){if(e.indexOf("-")==0){e=e.replace("-","");c="负"}if(e.indexOf("+")==0){e=e.replace("+","")}}var v="";var j="";var g;var q;var k,a,n,x;var h;var s,o,u;var b,f;var l=(typeof(w)=="undefined"||w==null||Number(w)<0||Number(w)>5);q=e.split(".");if(q.length>1){v=q[0];j=q[1];if(l){w=j.length>5?5:j.length}var t=Number("0."+j);t*=Math.pow(10,w);t=Math.round(Math.abs(t));t/=Math.pow(10,w);var m=t.toString().split(".");if(Number(m[0])==1){v=(Number(v)+1).toString()}if(m.length>1){j=m[1]}else{j=""}}else{v=e;j="";if(l){w=0}}if(v.length>44){return"错误：金额值太大了！整数位长【"+v.length.toString()+"】超过了上限——44位/千正/10^43（注：1正=1万涧=1亿亿亿亿亿，10^40）！"}k=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖");a=new Array("","拾","佰","仟");n=new Array("","万","亿","兆","京","垓","杼","穰","沟","涧","正");x=new Array("角","分","厘","毫","丝");g="";if(Number(v)>0){h=0;for(s=0;s<v.length;s++){o=v.length-s-1;u=v.substr(s,1);b=o/4;f=o%4;if(u=="0"){h++}else{if(h>0){g+=k[0]}h=0;g+=k[Number(u)]+a[f]}if(f==0&&h<4){g+=n[b]}}g+="元"}for(s=0;s<j.length;s++){u=j.substr(s,1);if(u!="0"){g+=k[Number(u)]+x[s]}}if(g==""){g="零元"}if(j==""){g+="整"}g=r+c+g;return g}function DateAdd(a,c,b){switch(a){case"y":b.setFullYear(b.getFullYear()+c);return b;break;case"q":b.setMonth(b.getMonth()+c*3);return b;break;case"m":b.setMonth(b.getMonth()+c);return b;break;case"w":b.setDate(b.getDate()+c*7);return b;break;case"d":b.setDate(b.getDate()+c);return b;break;case"h":b.setHours(b.getHours()+c);return b;break;case"m":b.setMinutes(b.getMinutes()+c);return b;break;case"s":b.setSeconds(b.getSeconds()+c);return b;break;default:b.setDate(d.getDate()+c);return b;break}}function select2AjaxSelectTag(b,m,j,g,h,n,l){var f=$("#"+b);var k=(m||j||"").toLowerCase();var e={};g=(g||"description").toLowerCase();h=h.replace(/['"]/g,"");var a=function(o){if(o.loading){return o.text}var p=o[k]+"-"+o[g];return p};var c=function(o){return o[g]};e[k]=-1;e.id=-1;e[g]=l;f.select2({placeholder:e,allowClear:true,ajax:{url:h,dataType:"json",delay:250,data:function(o){return{quickSearchCause:o.term,render:"json",jsonhead:'[{"total_count":"count"},{"fixText":"\\"items\\":"}]',startStr:"{",endStr:"}"}},processResults:function(q,r){r.page=r.page||1;var p=q.items;var o=p.length;if(o>0){if(p[0].id==undefined){for(i=0;i<o;i++){p[i].id=p[i][k]}}}return{results:q.items,pagination:{more:(r.page*20)<q.total_count}}},cache:true},initSelection:function(p,r){var q={};var o=f.find("option:selected");q[k]=o.val();q.id=o.val();q[g]=o.text();r(q)},escapeMarkup:function(o){return o},minimumInputLength:1,templateResult:a,templateSelection:c})}function select2CustomSelectTag(c,b,a){$("#"+c).select2({placeholder:b||"Select an option",allowClear:a})}function initAccountingPlugin(){window.accounting=window.accounting||{};accounting.settings={currency:{symbol:"￥",format:"%s%v",decimal:".",thousand:",",precision:2},number:{precision:0,thousand:",",decimal:"."}}}function executActionMethod(me,e){var actionurl=$(me).attr("url");if(actionurl==undefined||actionurl==""){return}if($(me).attr("disabled")=="true"){return}$(me).attr("disabled","true");var msgid=$(me).attr("msgid");if(msgid!=undefined&&msgid!=""){$("#"+msgid).hide()}var callback=$(me).attr("callback");$.ajax({type:"POST",url:actionurl,dataType:"html",data:$("*").serialize(),cache:false,success:function(data,textStatus){if(msgid!=undefined&&msgid!=""&&data!=""){$("#"+msgid).show();$("#"+msgid).html(data)}if(callback!=undefined&&callback!=""){try{eval(callback)}catch(exception){}}$(me).removeAttr("disabled")},error:function(request,textStatus,e){if(msgid!=undefined&&msgid!=""){$("#"+msgid).show();$("#"+msgid).html(request+","+textStatus+","+e)}$(me).removeAttr("disabled")}})}function executeaction(a,b){executActionMethod(a,b)}function setRequiredOrNot(j,g,k){var f=$(j);var n=function(a){f.parent().prev().attr("class","form_td_label required");f.parent().children().each(function(p,q){$(q).show()})};var e=function(a){f.removeAttr("readonly");f.attr("required","required")};var b=function(a){f.attr("readonly","readonly");f.removeAttr("required")};if(g){if("select"==k){f.parent().parent().prev().attr("class","form_td_label required");f.removeAttr("disabled");var h=f.attr("selectclass");if(typeof(h)!="undefined"){f.attr("class",h)}e(j)}else{if("date"==k){n(j);var o=f.attr("dateclass");if(typeof(o)!="undefined"){f.attr("class",o)}e(j)}else{if("lookup"==k){var m=$("#"+(f.attr("id")+"_DESC"));f.parent().children().each(function(a,p){if($(p).attr("id")!=m.attr("id")){$(p).show()}});var c=m.attr("lookupclass");if(typeof(c)!="undefined"){m.attr("lookupclass",c);m.attr("class",c)}f.removeAttr("readonly");f.removeAttr("style");f.parent().parent().find(".form_td_label").addClass("required")}else{n(j);var l=f.attr("oldclass");if(typeof(l)!="undefined"){f.attr("class",l)}e(j)}}}}else{if("select"==k){f.parent().parent().prev().attr("class","form_td_label");f.attr("selectclass",f.attr("class"));f.attr("disabled","disabled");b(j);f.removeAttr("class")}else{if("date"==k){f.parent().prev().attr("class","form_td_label");f.parent().children().each(function(a,p){if($(p).attr("id")!=f.attr("id")){$(p).hide()}});var o=f.attr("dateclass");if(typeof(o)=="undefined"){f.attr("dateclass",f.attr("class"))}b(j);f.attr("class","form_td_100")}else{if("lookup"==k){var m=$("#"+(f.attr("id")+"_DESC"));f.parent().prev().attr("class","form_td_label");f.parent().children().each(function(a,p){if($(p).attr("id")!=m.attr("id")){$(p).hide()}});var c=m.attr("lookupclass");if(typeof(c)=="undefined"){m.attr("lookupclass",m.attr("class"))}b(m);m.attr("class","form_td_multipart_readonly")}else{f.parent().prev().attr("class","form_td_label");f.parent().children().each(function(a,p){if($(p).attr("id")!=f.attr("id")){$(p).hide()}});var l=f.attr("oldclass");if(typeof(l)=="undefined"){f.attr("oldclass",f.attr("class"))}f.attr("class","form_td_100");b(j)}}}}}function setChildTableReadOnly(b){var a=$("tbody tr",b);var c=$("thead tr",b);if(c.length>0){$("thead>tr:first",b).hide();$("thead>tr:first",b).next().hide()}if(a.length>0){$("input",b).each(function(f,h){var e=$(this).closest("td").attr("useful");var g=$(this).attr("type");if("checkbox"==g){$(this).attr("disabled","disabled")}else{if(typeof(e)=="undefined"){$(this).closest("td").children().hide();var j=$(this).val();$(this).closest("td").append("<span title='"+j+"'>"+j+"</span>")}}});$("thead>tr>th",b).each(function(e,g){var f=$(this).attr("dataattribute");if(undefined==f||""==f){$(this).hide()}});$("tbody>tr>td",b).each(function(e,h){var f=$(this).attr("dataattribute");var g=$("select",$(this));if(undefined==f||""==f){if(!(g&&g.length>0)){$(this).hide()}}})}}(function(){initAccountingPlugin();$.extend($.fn,{mask:function(q,l,o){this.unmask();var k={opacity:0.8,z:10000,bgcolor:"#ccc"};var f=$(document.body);var j={top:0,left:0};if(this[0]&&this[0]!==window.document){f=this;j=f.position()}var e=$('<div id="maskdivgen" class="maskdivgen">&nbsp;</div>');var n=f.outerWidth();if(!n){n=f.width()}var a=f.outerHeight();if(!a){a=f.height()}e.css({position:"absolute",top:j.top,left:j.left,"z-index":k.z,width:n,height:a,"background-color":k.bgcolor,opacity:0});e.appendTo(f);$(window).resize(function(){var w=$("#maskdivgen");var x=f.outerWidth();if(!x){x=f.width()}var u=f.outerHeight();if(!u){u=f.height()}w.css({height:u+"px",width:x+"px"});var v=$("#msgDiv");var s=(w.width()-v.width());var r=$(document).scrollTop();var t=window.screen.availHeight;v.css({left:(s/2)+"px",top:(t/2+r-150)+"px"})});$(window).scroll(function(){var v=$("#maskdivgen");var u=$("#msgDiv");var s=(v.width()-u.width());var r=$(document).scrollTop();var t=window.screen.availHeight;u.css({left:(s/2)+"px",top:(t/2+r-150)+"px"})});if(l){e.addClass(l)}if(q){var c=Object.prototype.toString.call(q)==="[object String]";if(c){var m=$('<div id="msgDiv"><div style="line-height:24px;border:#a3bad9 1px solid;background:white;padding:2px 10px 2px 10px">'+q+"</div></div>");m.css({position:"absolute",border:"#6593cf 1px solid",padding:"2px;background:#ccca"});m.appendTo(e);var h=(e.width()-m.width());var b=$(document).scrollTop();var p=window.screen.availHeight;var g=(e.height()-m.height());m.css({cursor:"wait",top:(p/2+b-150),left:(h/2)})}else{if(q.element){var m=$(q.element);e.html(m)}else{var m=$('<div id="msgDiv"></div>');m.css({position:"absolute",border:"#6593cf 1px solid",padding:"2px;background:#ccca"});q.appendTo(m);m.appendTo(e);var h=(e.width()-m.width());var b=$(document).scrollTop();var p=window.screen.availHeight;var g=(e.height()-m.height());m.css({cursor:"wait",top:(p/2+b-150),left:(h/2)})}}}e.fadeIn("fast",function(){if(jQuery.isFunction(o)){$(this).fadeTo("slow",k.opacity,o)}else{$(this).fadeTo("slow",k.opacity)}})},unmask:function(){var a=$(document.body);if(this[0]&&this[0]!==window.document){a=$(this[0])}a.find("> div.maskdivgen").fadeOut("slow",0,function(){$(this).remove()})},queueMask:function(e,b){$(this).mask(e[0]);var f=$("#msgDiv").find("div").width(140);var a=[];for(var c=0;c<e.length;c++){(function(g){a.push(function(){f.html(e[g]);setTimeout(function(){if(g==e.length-1){f.queue("mx",a)}f.dequeue("mx")},b)})})(c)}f.queue("mx",a);f.dequeue("mx")},dequeueMask:function(){$("#msgDiv").find("div").queue("mx",[]);$(this).unmask()}})})();$(function(){$("body").keydown(function(a){var b=$("span[mxevent='searchOk']");if(b.length==0){return}if(!b.is(":visible")){return}if(a.keyCode=="13"){$(":focus").blur();b.click()}})});function createLayout(a){var c=$("#"+a);var b=getLayoutOptions(c);b.applyDemoStyles=false;c.layout(b)}function getLayoutOptions(b){var a={};b.find(">.ui-layout-pane").each(function(){var e=$(this);var c=e.attr("region");a[c]={};if(c!="center"){if(e.attr("size")){a[c].size=e.attr("size")}if(e.attr("minSize")){a[c].minSize=e.attr("minSize")}if(e.attr("maxSize")){a[c].maxSize=e.attr("maxSize")}a[c].resizable=!(e.attr("resizable")=="false");a[c].closable=!(e.attr("closable")=="false");a[c].spacing_open=parseInt(e.attr("space"));if(e.attr("status")=="close"){a[c].initClosed=true}else{if(e.attr("status")=="hidden"){a[c].initHidden=true}}}});return a}function resizeLayout(c,a){var b=c.find(".ui-layout-container.panel").data("layout");if(b){if($.isFunction(a)){a()}b.resizeAll()}}function loadingMask(b,a){if(a){b.mask({element:'<div class="loading-mask float-loading-mask"><span class="loading"></span></div>'})}else{b.html('<div class="loading-mask empty-loading-mask"><span class="loading"></span></div>')}}function loadingUnmask(a){var b=a.find(".loading-mask");if(b.is(".empty-loading-mask")){b.remove()}else{a.unmask()}}function processTreeNode(a){return a};