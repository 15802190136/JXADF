var JxMenu=(function(){var b=function(d,e){this.menuDiv=typeof e=="object"?e:$("#"+e);var c={idKey:"app",pIdKey:"parent",menuData:null,iconBase:""};this.setting=$.extend(c,d);this.initData();e.addClass("jxMenuDiv");if(langCode=="en"){$(".popupWin").addClass("en")}};var a=null;b.prototype.transformToTreeData=function(h){var f,c,e=h.idKey,d=h.pIdKey,g=h.menuData;childKey="children";if(!e||e==""||!g){return[]}var j=[];var k=[];for(f=0,c=g.length;f<c;f++){k[g[f][e]]=g[f]}for(f=0,c=g.length;f<c;f++){if(k[g[f][d]]&&g[f][e]!=g[f][d]){if(!k[g[f][d]][childKey]){k[g[f][d]][childKey]=[]}k[g[f][d]][childKey].push(g[f])}else{j.push(g[f])}}return j};b.prototype.mouseOverEventHandler=function(j){a&&clearTimeout(a);var l,g=$(this).offset().top-j.data.menuDiv.position().top,f=$(window).height(),k=j.data.menuDiv.outerHeight(),d=$(document).scrollTop(),c=f-(g-d),h=$(".subMenu",$(this)[0].parentNode),m=$(".popupWin"),n=20,p=h.children();if(p.length<=0){m.hide();return false}var i=p.clone(true);i.last().css({"border-bottom":"none","margin-bottom":"0"});h.hide();j.data.curSubMenu=i;m.removeAttr("style").html("<div class='popupWin_bg'></div><div class='popupWin_content'></div>").find(".popupWin_content").append(i).show();subMenuHeight=m.height();if(subMenuHeight<=c){l=g}else{if(subMenuHeight>c&&subMenuHeight<k){l=d+f-subMenuHeight-5}else{subMenuHeight=k-n;l=d-j.data.menuDiv.position().top}}var o=l-j.data.menuDiv.parent().position().top;if(o<0){o=0}m.css({top:o,left:"246px",height:subMenuHeight,display:"block"})};b.prototype.mouseOutEventHandler=function(){a=setTimeout(function(){$(".popupWin").hide()},20)};b.prototype.createMenu=function(e,m){if(e!=null){var d=this.menuDiv;var j=false;for(var h=0;h<e.length;h++){if(!e[h].parent){var k=$('<span class="icon-module icon-module-'+e[h].app.toLowerCase()+'"></span>');var f=$('<div class="menuContainer"></div>').append(k).append($('<div id="'+e[h].app+'" class="menuItem" '+(e[h].appUrl?('appUrl="'+e[h].appUrl):"")+'" app="'+e[h].app+'" appId="'+e[h].maxAppsId+'">'+e[h].description+"</div> "));var l=$("<div class='topMenu'></div>");l.append(f).appendTo(d);if(e[h].children!=null){this.createMenu(e[h].children,$('<div class="subMenu"></div>').appendTo(l))}}if(e[h].appType=="MODULE"&&e[h].parent){j=false;var c=$('<dt appUrl="'+e[h].appUrl+'" app="'+e[h].app+'" appId="'+e[h].maxAppsId+'">'+e[h].description+"</dt>");if(m!=null){if(m.length>1&&m[0].tagName=="DL"||m[0].tagName=="DD"){m=m.closest(".subMenu")}}if(m!=null){var g=$("<dl/>").append(c).appendTo(m);if(e[h].children!=null){this.createMenu(e[h].children,g)}}}if(e[h].appType=="APP"&&m){if(m[0].tagName!="DL"&&m[0].tagName!="DD"){m=$("<dl/>").appendTo(m)}if(!j){m=$('<dd><em appUrl="'+e[h].appUrl+'" app="'+e[h].app+'" appId="'+e[h].maxAppsId+'">'+e[h].description+"</em></dd>").appendTo(m);j=true}else{$('<em appUrl="'+e[h].appUrl+'" app="'+e[h].app+'" appId="'+e[h].maxAppsId+'">'+e[h].description+"</em>").appendTo(m)}}}}};b.prototype.menuClickEventHandler=function(c){if($(this).attr("appUrl")!=undefined&&$(this).attr("appUrl")!=""){if(typeof c.data.onMenuClick=="function"){if(c.data.curSubMenu){c.data.curSubMenu.toggle()}c.data.onMenuClick(c);$(".popupWin").hide()}}};b.prototype.menuHisBtnClickEventHandler=function(f){var d=$(".popupWin");var c=$("#menuAppBar");d.css({top:c.position().top+c.outerHeight(),left:"22px",height:"250px"});if(!d.is(":visible")){WebClientBean.getMenuHisData(function(e){function g(j,m){var l=$("<dt/>").text(m);var h=$("<dd/>");for(var k=0;k<j.length;k++){$("<em/>").text(j[k].DESCRIPTION).attr("appUrl",j[k].APPURL).attr("app",j[k].APP).appendTo(h)}$("<dl/>").addClass("subMemuFont").append(l).append(h).appendTo(d)}d.empty();if(e==null){return}g(e.favoriteApp,getLangString("home.myFavorite"));g(e.recentApp,getLangString("home.recentVisit"))});f.data.curSubMenu=d}d.toggle()};b.prototype.loadModuleImg=function(g,e){var f=$(g).find(".moduleIcon");var d=$(g).find(".menuItem");var c=this.setting.iconBase+"menu/"+d.attr("ID").toLowerCase()+e+".png";this.imgLoad(c,f)};b.prototype.initData=function(){if(this.setting.menuData==null){return}var d=$(".popupWin");var e=this.transformToTreeData(this.setting);this.menuDiv.on("mouseenter",".menuContainer",this,this.mouseOverEventHandler);this.menuDiv.on("mouseleave",".menuContainer",$.proxy(this.mouseOutEventHandler,this));this.menuDiv.on("click",".menuItem, .subMenu dt, .subMenu  em",this,this.menuClickEventHandler);$(".visitHisBtn").on("click",null,this,this.menuHisBtnClickEventHandler);this.autoComplete();d.on("click","em",this,this.menuClickEventHandler);d.on("mouseleave",function(){$(this).hide()}).on("mouseenter",$.proxy(function(){a&&clearTimeout(a)},this));this.createMenu(e,null);var c=this};b.prototype.autoComplete=function(){var c=[];$.each(this.setting.menuData,function(e,f){c.push({label:f.description,value:f.description,target:"#mainMenu [appid="+f.maxAppsId+"]",appUrl:f.appUrl})});var d=$.fn.menu;$.widget.bridge("menu",$.ui.menu);$(".input-txt","#menuAppBar").autocomplete({source:c,select:function(g,f){if(f.item.appUrl){$(f.item.target).trigger("click")}else{$(f.item.target).trigger("mouseover")}}}).on("keypress",function(g){var f=$(".ui-autocomplete");if(f.is(":visible")&&g.keyCode==13){f.find("a").eq(0).trigger("click");$(this).blur()}}).on("focusin",function(){$(".popupWin").hide();$(this).val("")});$.fn.menu=d};b.prototype.imgLoad=function(d,e){var c=new Image();c.src=d;if(c.complete){e.attr("src",d)}else{c.onload=function(){e.attr("src",d);c.onload=null}}};return b})();function onMenuClick(d){var c=$(d.target);var a=c.attr("appUrl");if(!a){return false}var b;if(a.indexOf("http://")>=0){b=a}else{b=contextPath+"/"+a}var f=c.text()||c.attr("title");loadApp(f,b);if(typeof(onAppMenuClick)=="function"){if(b.indexOf("http://")!=0){b="http://"+document.domain+b}onAppMenuClick(d,c.attr("app"),b)}else{WebClientBean.saveMaxAppVisitData(c.attr("app"))}closeWest()};